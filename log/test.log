  [1m[35m (52.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "tv_shows_api_test"[0m
  [1m[35m (127.5ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (18.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (4.8ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (3.7ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 11:33:37.239014', '2025-06-09 11:33:37.239016') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 11:33:37.241650', '2025-06-09 11:33:37.241652') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (7.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:41.825560"], ["updated_at", "2025-06-09 11:33:41.825560"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:41.859947"], ["updated_at", "2025-06-09 11:33:41.859947"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:41.887552"], ["updated_at", "2025-06-09 11:33:41.887552"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 11:33:41.908793"], ["updated_at", "2025-06-09 11:33:41.908793"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 12:33:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 12ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 1.1ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:41.990829"], ["updated_at", "2025-06-09 11:33:41.990829"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:41.999863"], ["updated_at", "2025-06-09 11:33:41.999863"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.005198"], ["updated_at", "2025-06-09 11:33:42.005198"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 11:33:42.007899"], ["updated_at", "2025-06-09 11:33:42.007899"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (5.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 2]]
Completed 200 OK in 31ms (Views: 0.1ms | ActiveRecord: 11.9ms (2 queries, 0 cached) | GC: 2.8ms)
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.047856"], ["updated_at", "2025-06-09 11:33:42.047856"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.049823"], ["updated_at", "2025-06-09 11:33:42.049823"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.052923"], ["updated_at", "2025-06-09 11:33:42.052923"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (2.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 11:33:42.054809"], ["updated_at", "2025-06-09 11:33:42.054809"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (3.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 3]]
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 4.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.068816"], ["updated_at", "2025-06-09 11:33:42.068816"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.070313"], ["updated_at", "2025-06-09 11:33:42.070313"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.073099"], ["updated_at", "2025-06-09 11:33:42.073099"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 11:33:42.075566"], ["updated_at", "2025-06-09 11:33:42.075566"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.080512"], ["updated_at", "2025-06-09 11:33:42.080512"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.083916"], ["updated_at", "2025-06-09 11:33:42.083916"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.086529"], ["updated_at", "2025-06-09 11:33:42.086529"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 11:33:42.089225"], ["updated_at", "2025-06-09 11:33:42.089225"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (1.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 5]]
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 4.6ms (2 queries, 0 cached) | GC: 0.7ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.099915"], ["updated_at", "2025-06-09 11:33:42.099915"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.101309"], ["updated_at", "2025-06-09 11:33:42.101309"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.104668"], ["updated_at", "2025-06-09 11:33:42.104668"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 11:33:42.106650"], ["updated_at", "2025-06-09 11:33:42.106650"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (2.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "network"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 500 Internal Server Error in 4ms (ActiveRecord: 2.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.115766"], ["updated_at", "2025-06-09 11:33:42.115766"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.117436"], ["updated_at", "2025-06-09 11:33:42.117436"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.120303"], ["updated_at", "2025-06-09 11:33:42.120303"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 11:33:42.122301"], ["updated_at", "2025-06-09 11:33:42.122301"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (10.6ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 7]]
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 12.7ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.8ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.144851"], ["updated_at", "2025-06-09 11:33:42.144851"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.146781"], ["updated_at", "2025-06-09 11:33:42.146781"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:33:42.150580"], ["updated_at", "2025-06-09 11:33:42.150580"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 8], ["created_at", "2025-06-09 11:33:42.152434"], ["updated_at", "2025-06-09 11:33:42.152434"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 12:33:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (0.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "network"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (9.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.006166"], ["updated_at", "2025-06-09 11:34:42.006166"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.047683"], ["updated_at", "2025-06-09 11:34:42.047683"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.073555"], ["updated_at", "2025-06-09 11:34:42.073555"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 9], ["created_at", "2025-06-09 11:34:42.090483"], ["updated_at", "2025-06-09 11:34:42.090483"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (4.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 9]]
Completed 200 OK in 23ms (Views: 0.3ms | ActiveRecord: 10.4ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (2.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 2.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.152068"], ["updated_at", "2025-06-09 11:34:42.152068"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.154301"], ["updated_at", "2025-06-09 11:34:42.154301"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.157880"], ["updated_at", "2025-06-09 11:34:42.157880"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 11:34:42.160748"], ["updated_at", "2025-06-09 11:34:42.160748"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (2.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 10]]
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 5.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.174937"], ["updated_at", "2025-06-09 11:34:42.174937"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.177172"], ["updated_at", "2025-06-09 11:34:42.177172"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.179969"], ["updated_at", "2025-06-09 11:34:42.179969"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 11], ["created_at", "2025-06-09 11:34:42.181739"], ["updated_at", "2025-06-09 11:34:42.181739"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.185740"], ["updated_at", "2025-06-09 11:34:42.185740"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.187633"], ["updated_at", "2025-06-09 11:34:42.187633"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.190840"], ["updated_at", "2025-06-09 11:34:42.190840"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 11:34:42.193627"], ["updated_at", "2025-06-09 11:34:42.193627"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (4.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 12]]
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 8.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.216397"], ["updated_at", "2025-06-09 11:34:42.216397"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.219229"], ["updated_at", "2025-06-09 11:34:42.219229"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.223062"], ["updated_at", "2025-06-09 11:34:42.223062"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 13], ["created_at", "2025-06-09 11:34:42.225397"], ["updated_at", "2025-06-09 11:34:42.225397"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (10.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 13]]
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 11.9ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (1.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.248660"], ["updated_at", "2025-06-09 11:34:42.248660"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.250669"], ["updated_at", "2025-06-09 11:34:42.250669"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.254493"], ["updated_at", "2025-06-09 11:34:42.254493"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 11:34:42.256806"], ["updated_at", "2025-06-09 11:34:42.256806"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (15.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 14]]
Completed 200 OK in 20ms (Views: 0.1ms | ActiveRecord: 17.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.280961"], ["updated_at", "2025-06-09 11:34:42.280961"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.282858"], ["updated_at", "2025-06-09 11:34:42.282858"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.286244"], ["updated_at", "2025-06-09 11:34:42.286244"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 11:34:42.288502"], ["updated_at", "2025-06-09 11:34:42.288502"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (1.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (4.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 15]]
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 6.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.301167"], ["updated_at", "2025-06-09 11:34:42.301167"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.302647"], ["updated_at", "2025-06-09 11:34:42.302647"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:34:42.305120"], ["updated_at", "2025-06-09 11:34:42.305120"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 11:34:42.307028"], ["updated_at", "2025-06-09 11:34:42.307028"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 12:34:42 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (1.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 11:34:46.401778"], ["updated_at", "2025-06-09 11:34:46.401778"]]
  [1m[36mTvShow Load (1.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 456], ["created_at", "2025-06-09 11:34:46.407597"], ["updated_at", "2025-06-09 11:34:46.407597"]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 123], ["created_at", "2025-06-09 11:34:46.414658"], ["updated_at", "2025-06-09 11:34:46.414658"]]
  [1m[36mReleaseDate Load (0.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 17], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 17], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 17], ["created_at", "2025-06-09 11:34:46.418888"], ["updated_at", "2025-06-09 11:34:46.418888"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (4.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.8ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.9ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.6ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 11:34:46.452378"], ["updated_at", "2025-06-09 11:34:46.452378"]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 456], ["created_at", "2025-06-09 11:34:46.460057"], ["updated_at", "2025-06-09 11:34:46.460057"]]
  [1m[36mEpisode Load (1.0ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 123], ["created_at", "2025-06-09 11:34:46.467397"], ["updated_at", "2025-06-09 11:34:46.467397"]]
  [1m[36mReleaseDate Load (1.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 18], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 18], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 18], ["created_at", "2025-06-09 11:34:46.473315"], ["updated_at", "2025-06-09 11:34:46.473315"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.5ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.7ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 18], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 18], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 18], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (1.9ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (6.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 11:35:09.149337"], ["updated_at", "2025-06-09 11:35:09.149337"]]
  [1m[36mTvShow Load (1.8ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 456], ["created_at", "2025-06-09 11:35:09.180325"], ["updated_at", "2025-06-09 11:35:09.180325"]]
  [1m[36mEpisode Load (2.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 19], ["tvmaze_id", 123], ["created_at", "2025-06-09 11:35:09.204684"], ["updated_at", "2025-06-09 11:35:09.204684"]]
  [1m[36mReleaseDate Load (2.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 19], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 19], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 19], ["created_at", "2025-06-09 11:35:09.222667"], ["updated_at", "2025-06-09 11:35:09.222667"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (2.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.7ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.9ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 11:35:09.244122"], ["updated_at", "2025-06-09 11:35:09.244122"]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 456], ["created_at", "2025-06-09 11:35:09.247595"], ["updated_at", "2025-06-09 11:35:09.247595"]]
  [1m[36mEpisode Load (0.9ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 20], ["tvmaze_id", 123], ["created_at", "2025-06-09 11:35:09.252478"], ["updated_at", "2025-06-09 11:35:09.252478"]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 20], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 20], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 20], ["created_at", "2025-06-09 11:35:09.255578"], ["updated_at", "2025-06-09 11:35:09.255578"]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 20], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 20], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 20], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.322394"], ["updated_at", "2025-06-09 11:35:09.322394"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.324268"], ["updated_at", "2025-06-09 11:35:09.324268"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.328289"], ["updated_at", "2025-06-09 11:35:09.328289"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 21], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 21], ["created_at", "2025-06-09 11:35:09.332384"], ["updated_at", "2025-06-09 11:35:09.332384"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (6.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (5.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 21]]
Completed 200 OK in 22ms (Views: 0.1ms | ActiveRecord: 11.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (3.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 3.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.383521"], ["updated_at", "2025-06-09 11:35:09.383521"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.385357"], ["updated_at", "2025-06-09 11:35:09.385357"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.389715"], ["updated_at", "2025-06-09 11:35:09.389715"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 22], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 22], ["created_at", "2025-06-09 11:35:09.392084"], ["updated_at", "2025-06-09 11:35:09.392084"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.396153"], ["updated_at", "2025-06-09 11:35:09.396153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.398001"], ["updated_at", "2025-06-09 11:35:09.398001"]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.406019"], ["updated_at", "2025-06-09 11:35:09.406019"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 23], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 23], ["created_at", "2025-06-09 11:35:09.408490"], ["updated_at", "2025-06-09 11:35:09.408490"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.8ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 23]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 9.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.424610"], ["updated_at", "2025-06-09 11:35:09.424610"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.426360"], ["updated_at", "2025-06-09 11:35:09.426360"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.429691"], ["updated_at", "2025-06-09 11:35:09.429691"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 24], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 24], ["created_at", "2025-06-09 11:35:09.431600"], ["updated_at", "2025-06-09 11:35:09.431600"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (2.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (4.7ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 24]]
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 7.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (2.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 2.8ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.449322"], ["updated_at", "2025-06-09 11:35:09.449322"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.451558"], ["updated_at", "2025-06-09 11:35:09.451558"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.456800"], ["updated_at", "2025-06-09 11:35:09.456800"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 25], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 25], ["created_at", "2025-06-09 11:35:09.458964"], ["updated_at", "2025-06-09 11:35:09.458964"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (3.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 25]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 9.5ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.474660"], ["updated_at", "2025-06-09 11:35:09.474660"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.476912"], ["updated_at", "2025-06-09 11:35:09.476912"]]
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.483040"], ["updated_at", "2025-06-09 11:35:09.483040"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 26], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 26], ["created_at", "2025-06-09 11:35:09.485057"], ["updated_at", "2025-06-09 11:35:09.485057"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (1.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 26]]
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 8.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.500010"], ["updated_at", "2025-06-09 11:35:09.500010"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (5.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.502093"], ["updated_at", "2025-06-09 11:35:09.502093"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.512400"], ["updated_at", "2025-06-09 11:35:09.512400"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 27], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 27], ["created_at", "2025-06-09 11:35:09.514816"], ["updated_at", "2025-06-09 11:35:09.514816"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (1.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (3.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 27]]
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 4.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.524591"], ["updated_at", "2025-06-09 11:35:09.524591"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.526089"], ["updated_at", "2025-06-09 11:35:09.526089"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 28], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 28], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 11:35:09.529098"], ["updated_at", "2025-06-09 11:35:09.529098"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 28], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 28], ["created_at", "2025-06-09 11:35:09.530977"], ["updated_at", "2025-06-09 11:35:09.530977"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 12:35:09 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (1.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (7.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:04:10.871102"], ["updated_at", "2025-06-09 12:04:10.871102"]]
  [1m[36mTvShow Load (2.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:04:10.897958"], ["updated_at", "2025-06-09 12:04:10.897958"]]
  [1m[36mEpisode Load (1.6ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 29], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:04:10.917423"], ["updated_at", "2025-06-09 12:04:10.917423"]]
  [1m[36mReleaseDate Load (2.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 29], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 29], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 29], ["created_at", "2025-06-09 12:04:10.933144"], ["updated_at", "2025-06-09 12:04:10.933144"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 29], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 29], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 29], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:04:10.969042"], ["updated_at", "2025-06-09 12:04:10.969042"]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 30], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:04:10.970704"], ["updated_at", "2025-06-09 12:04:10.970704"]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 30], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:04:10.973568"], ["updated_at", "2025-06-09 12:04:10.973568"]]
  [1m[36mReleaseDate Load (0.2ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 30], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 30], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 30], ["created_at", "2025-06-09 12:04:10.975386"], ["updated_at", "2025-06-09 12:04:10.975386"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.034226"], ["updated_at", "2025-06-09 12:04:11.034226"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 31], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.040715"], ["updated_at", "2025-06-09 12:04:11.040715"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 31], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.049154"], ["updated_at", "2025-06-09 12:04:11.049154"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 31], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 31], ["created_at", "2025-06-09 12:04:11.052308"], ["updated_at", "2025-06-09 12:04:11.052308"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (6.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (9.5ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 31]]
Completed 200 OK in 27ms (Views: 0.3ms | ActiveRecord: 16.1ms (2 queries, 0 cached) | GC: 0.9ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.110375"], ["updated_at", "2025-06-09 12:04:11.110375"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.112379"], ["updated_at", "2025-06-09 12:04:11.112379"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.115960"], ["updated_at", "2025-06-09 12:04:11.115960"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 32], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 32], ["created_at", "2025-06-09 12:04:11.117806"], ["updated_at", "2025-06-09 12:04:11.117806"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (4.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 32]]
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 5.9ms (2 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.130583"], ["updated_at", "2025-06-09 12:04:11.130583"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 33], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.132253"], ["updated_at", "2025-06-09 12:04:11.132253"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 33], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.136960"], ["updated_at", "2025-06-09 12:04:11.136960"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 33], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 33], ["created_at", "2025-06-09 12:04:11.139852"], ["updated_at", "2025-06-09 12:04:11.139852"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (3.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (6.6ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 33]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 9.6ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.156060"], ["updated_at", "2025-06-09 12:04:11.156060"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 34], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.157956"], ["updated_at", "2025-06-09 12:04:11.157956"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 34], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 34], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 34], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.162632"], ["updated_at", "2025-06-09 12:04:11.162632"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 34], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 34], ["created_at", "2025-06-09 12:04:11.164860"], ["updated_at", "2025-06-09 12:04:11.164860"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (3.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.7ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 34]]
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 11.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.183032"], ["updated_at", "2025-06-09 12:04:11.183032"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 35], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.186006"], ["updated_at", "2025-06-09 12:04:11.186006"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 35], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 35], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 35], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.190435"], ["updated_at", "2025-06-09 12:04:11.190435"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 35], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 35], ["created_at", "2025-06-09 12:04:11.192990"], ["updated_at", "2025-06-09 12:04:11.192990"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.197216"], ["updated_at", "2025-06-09 12:04:11.197216"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 36], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.199416"], ["updated_at", "2025-06-09 12:04:11.199416"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 36], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 36], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 36], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.203712"], ["updated_at", "2025-06-09 12:04:11.203712"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 36], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 36], ["created_at", "2025-06-09 12:04:11.206284"], ["updated_at", "2025-06-09 12:04:11.206284"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (3.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 36]]
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 10.7ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (2.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 2.4ms (1 query, 0 cached) | GC: 0.1ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.228750"], ["updated_at", "2025-06-09 12:04:11.228750"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 37], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.230690"], ["updated_at", "2025-06-09 12:04:11.230690"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 37], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 37], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 37], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.237541"], ["updated_at", "2025-06-09 12:04:11.237541"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 37], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 37], ["created_at", "2025-06-09 12:04:11.240259"], ["updated_at", "2025-06-09 12:04:11.240259"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.245057"], ["updated_at", "2025-06-09 12:04:11.245057"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 38], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.247162"], ["updated_at", "2025-06-09 12:04:11.247162"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 38], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 38], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 38], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:04:11.250914"], ["updated_at", "2025-06-09 12:04:11.250914"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 38], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 38], ["created_at", "2025-06-09 12:04:11.252897"], ["updated_at", "2025-06-09 12:04:11.252897"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (2.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.5ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 38]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 9.0ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:04:11 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (2.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 2.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (878.8ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-3" ENCODING = 'unicode'[0m
  [1m[35m (880.5ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-1" ENCODING = 'unicode'[0m
  [1m[35m (868.5ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-4" ENCODING = 'unicode'[0m
  [1m[35m (865.3ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-6" ENCODING = 'unicode'[0m
  [1m[35m (892.5ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-0" ENCODING = 'unicode'[0m
  [1m[35m (868.4ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-8" ENCODING = 'unicode'[0m
  [1m[35m (879.9ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-2" ENCODING = 'unicode'[0m
  [1m[35m (876.8ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-5" ENCODING = 'unicode'[0m
  [1m[35m (876.0ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-7" ENCODING = 'unicode'[0m
  [1m[35m (883.9ms)[0m  [1m[35mCREATE DATABASE "tv_shows_api_test-9" ENCODING = 'unicode'[0m
  [1m[35mSQL (35.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35mSQL (40.0ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35mSQL (48.1ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35mSQL (47.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35mSQL (48.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (9.1ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35mSQL (42.1ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35mSQL (44.0ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.8ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (1.9ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35mSQL (49.6ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35mSQL (38.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (10.2ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (9.4ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35mSQL (42.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (10.9ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (6.8ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "distributors" CASCADE[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (10.2ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "distributors" ("id" bigserial primary key, "name" character varying NOT NULL, "country" character varying, "official_site" character varying, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (6.1ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (6.6ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_country" ON "distributors" ("country")[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (6.8ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (8.3ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_distributors_on_name" ON "distributors" ("name")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_distributors_on_tvmaze_id" ON "distributors" ("tvmaze_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "episodes" CASCADE[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "episodes" ("id" bigserial primary key, "name" character varying NOT NULL, "season" integer, "episode_number" integer, "episode_type" character varying, "runtime" integer, "rating" decimal(3,1), "image_medium" character varying, "image_original" character varying, "summary" text, "tv_show_id" bigint NOT NULL, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_episode_number" ON "episodes" ("episode_number")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_season" ON "episodes" ("season")[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tv_show_id_and_season_and_episode_number" ON "episodes" ("tv_show_id", "season", "episode_number")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_episodes_on_tv_show_id" ON "episodes" ("tv_show_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_episodes_on_tvmaze_id" ON "episodes" ("tvmaze_id")[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "release_dates" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "release_dates" ("id" bigserial primary key, "airdate" date NOT NULL, "airtime" character varying, "episode_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate_and_airtime" ON "release_dates" ("airdate", "airtime")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_release_dates_on_airdate_and_episode_id" ON "release_dates" ("airdate", "episode_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_airdate" ON "release_dates" ("airdate")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (5.4ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_release_dates_on_episode_id" ON "release_dates" ("episode_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "tv_shows" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (5.2ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "tv_shows" ("id" bigserial primary key, "name" character varying NOT NULL, "show_type" character varying, "language" character varying, "status" character varying, "runtime" integer, "premiered" date, "ended" date, "official_site" character varying, "rating" decimal(3,1), "genres" text, "schedule_time" character varying, "schedule_days" text, "image_medium" character varying, "image_original" character varying, "summary" text, "network_id" bigint, "tvmaze_id" integer NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (5.0ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_name" ON "tv_shows" ("name")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id_and_status" ON "tv_shows" ("network_id", "status")[0m
  [1m[35m (2.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[35m (2.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (5.6ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_network_id" ON "tv_shows" ("network_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[35m (4.7ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (1.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_premiered" ON "tv_shows" ("premiered")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_rating" ON "tv_shows" ("rating")[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_tv_shows_on_status" ON "tv_shows" ("status")[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (2.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_tv_shows_on_tvmaze_id" ON "tv_shows" ("tvmaze_id")[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.296202', '2025-06-09 12:06:51.296205') RETURNING "key"[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.295886', '2025-06-09 12:06:51.295890') RETURNING "key"[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE "episodes" ADD CONSTRAINT "fk_rails_d303bd807e"
FOREIGN KEY ("tv_show_id")
  REFERENCES "tv_shows" ("id")
[0m
  [1m[35m (2.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (2.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.300322', '2025-06-09 12:06:51.300324') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "release_dates" ADD CONSTRAINT "fk_rails_79bbce3ca0"
FOREIGN KEY ("episode_id")
  REFERENCES "episodes" ("id")
[0m
  [1m[35m (1.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.301279', '2025-06-09 12:06:51.301280') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.301044', '2025-06-09 12:06:51.301047') RETURNING "key"[0m
  [1m[35m (2.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "tv_shows" ADD CONSTRAINT "fk_rails_36c1785b52"
FOREIGN KEY ("network_id")
  REFERENCES "distributors" ("id")
[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (2.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (2.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.308744', '2025-06-09 12:06:51.308748') RETURNING "key"[0m
  [1m[35m (4.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.307860', '2025-06-09 12:06:51.307866') RETURNING "key"[0m
  [1m[35m (6.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (5.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.315297', '2025-06-09 12:06:51.315301') RETURNING "key"[0m
  [1m[35m (6.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.315816', '2025-06-09 12:06:51.315821') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.314673', '2025-06-09 12:06:51.314678') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.317496', '2025-06-09 12:06:51.317500') RETURNING "key"[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (2.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20250609110435)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20250609110430),
(20250609110425),
(20250609110418);[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.321928', '2025-06-09 12:06:51.321932') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.322585', '2025-06-09 12:06:51.322590') RETURNING "key"[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.323362', '2025-06-09 12:06:51.323367') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.321350', '2025-06-09 12:06:51.321355') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.331459', '2025-06-09 12:06:51.331463') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.329990', '2025-06-09 12:06:51.329996') RETURNING "key"[0m
  [1m[35m (9.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.334843', '2025-06-09 12:06:51.334847') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-06-09 12:06:51.335337', '2025-06-09 12:06:51.335342') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'a4d2e140647756e8a4d671e460614d693ad8584d', '2025-06-09 12:06:51.340986', '2025-06-09 12:06:51.340991') RETURNING "key"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mDistributor Load (0.9ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Load (1.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mDistributor Count (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Load (1.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:06:51.398106"], ["updated_at", "2025-06-09 12:06:51.398106"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:06:51.400254"], ["updated_at", "2025-06-09 12:06:51.400254"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (3.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (4.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:06:51.406967"], ["updated_at", "2025-06-09 12:06:51.406967"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.408321"], ["updated_at", "2025-06-09 12:06:51.408321"]]
  [1m[36mDistributor Count (1.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.409993"], ["updated_at", "2025-06-09 12:06:51.409993"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (5.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.408781"], ["updated_at", "2025-06-09 12:06:51.408781"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (2.0ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Load (1.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:06:51.417120"], ["updated_at", "2025-06-09 12:06:51.417120"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (5.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mDistributor Create (44.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.439618"], ["updated_at", "2025-06-09 12:06:51.439618"]]
  [1m[36mTvShow Create (4.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:06:51.482904"], ["updated_at", "2025-06-09 12:06:51.482904"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (3.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:06:51.484596"], ["updated_at", "2025-06-09 12:06:51.484596"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (3.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.493892"], ["updated_at", "2025-06-09 12:06:51.493892"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (1.0ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.6ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 1], ["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:06:51.508347"], ["updated_at", "2025-06-09 12:06:51.508347"]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:06:51.508952"], ["updated_at", "2025-06-09 12:06:51.508952"]]
  [1m[36mReleaseDate Load (0.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 1], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 1], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:06:51.521315"], ["updated_at", "2025-06-09 12:06:51.521315"]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:06:51.522308"], ["updated_at", "2025-06-09 12:06:51.522308"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mDistributor Count (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 1], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.565904"], ["updated_at", "2025-06-09 12:06:51.565904"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.566421"], ["updated_at", "2025-06-09 12:06:51.566421"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mDistributor Create (2.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.566226"], ["updated_at", "2025-06-09 12:06:51.566226"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.568346"], ["updated_at", "2025-06-09 12:06:51.568346"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.582592"], ["updated_at", "2025-06-09 12:06:51.582592"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.582921"], ["updated_at", "2025-06-09 12:06:51.582921"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.584789"], ["updated_at", "2025-06-09 12:06:51.584789"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.588479"], ["updated_at", "2025-06-09 12:06:51.588479"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.587051"], ["updated_at", "2025-06-09 12:06:51.587051"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:06:51.590631"], ["updated_at", "2025-06-09 12:06:51.590631"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.589004"], ["updated_at", "2025-06-09 12:06:51.589004"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:06:51.592958"], ["updated_at", "2025-06-09 12:06:51.592958"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.593732"], ["updated_at", "2025-06-09 12:06:51.593732"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.596159"], ["updated_at", "2025-06-09 12:06:51.596159"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.599604"], ["updated_at", "2025-06-09 12:06:51.599604"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:06:51.601921"], ["updated_at", "2025-06-09 12:06:51.601921"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.602974"], ["updated_at", "2025-06-09 12:06:51.602974"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.604884"], ["updated_at", "2025-06-09 12:06:51.604884"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:06:51.612949"], ["updated_at", "2025-06-09 12:06:51.612949"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:06:51.614671"], ["updated_at", "2025-06-09 12:06:51.614671"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Completed 400 Bad Request in 8ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 400 Bad Request in 8ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Processing by Api::V1::TvShowsController#index as HTML
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.645075"], ["updated_at", "2025-06-09 12:06:51.645075"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.645434"], ["updated_at", "2025-06-09 12:06:51.645434"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.646817"], ["updated_at", "2025-06-09 12:06:51.646817"]]
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 2]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.647072"], ["updated_at", "2025-06-09 12:06:51.647072"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.650434"], ["updated_at", "2025-06-09 12:06:51.650434"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.650669"], ["updated_at", "2025-06-09 12:06:51.650669"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.4ms | ActiveRecord: 3.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:06:51.652848"], ["updated_at", "2025-06-09 12:06:51.652848"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 12:06:51.652879"], ["updated_at", "2025-06-09 12:06:51.652879"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.658083"], ["updated_at", "2025-06-09 12:06:51.658083"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.659683"], ["updated_at", "2025-06-09 12:06:51.659683"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.663109"], ["updated_at", "2025-06-09 12:06:51.663109"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.4ms | ActiveRecord: 3.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 3]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 2]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 12:06:51.665817"], ["updated_at", "2025-06-09 12:06:51.665817"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 3.9ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 23ms (Views: 0.4ms | ActiveRecord: 4.3ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 3.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:06:51 +0100
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.671004"], ["updated_at", "2025-06-09 12:06:51.671004"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.671139"], ["updated_at", "2025-06-09 12:06:51.671139"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 3]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (1 query, 0 cached) | GC: 0.0ms)
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.672999"], ["updated_at", "2025-06-09 12:06:51.672999"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.673577"], ["updated_at", "2025-06-09 12:06:51.673577"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.677352"], ["updated_at", "2025-06-09 12:06:51.677352"]]
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 2], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.677573"], ["updated_at", "2025-06-09 12:06:51.677573"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 1], ["episode_number", 2], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:06:51.678535"], ["updated_at", "2025-06-09 12:06:51.678535"]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.679580"], ["updated_at", "2025-06-09 12:06:51.679580"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.679527"], ["updated_at", "2025-06-09 12:06:51.679527"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.679638"], ["updated_at", "2025-06-09 12:06:51.679638"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.679844"], ["updated_at", "2025-06-09 12:06:51.679844"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.681574"], ["updated_at", "2025-06-09 12:06:51.681574"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.681642"], ["updated_at", "2025-06-09 12:06:51.681642"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.682561"], ["updated_at", "2025-06-09 12:06:51.682561"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.684265"], ["updated_at", "2025-06-09 12:06:51.684265"]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 4], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:06:51.684892"], ["updated_at", "2025-06-09 12:06:51.684892"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.685469"], ["updated_at", "2025-06-09 12:06:51.685469"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.687844"], ["updated_at", "2025-06-09 12:06:51.687844"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 2], ["created_at", "2025-06-09 12:06:51.688568"], ["updated_at", "2025-06-09 12:06:51.688568"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 2], ["id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.691653"], ["updated_at", "2025-06-09 12:06:51.691653"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.691716"], ["updated_at", "2025-06-09 12:06:51.691716"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.691898"], ["updated_at", "2025-06-09 12:06:51.691898"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.693527"], ["updated_at", "2025-06-09 12:06:51.693527"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.693546"], ["updated_at", "2025-06-09 12:06:51.693546"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.694040"], ["updated_at", "2025-06-09 12:06:51.694040"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.694289"], ["updated_at", "2025-06-09 12:06:51.694289"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.696227"], ["updated_at", "2025-06-09 12:06:51.696227"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.697071"], ["updated_at", "2025-06-09 12:06:51.697071"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.697525"], ["updated_at", "2025-06-09 12:06:51.697525"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.699476"], ["updated_at", "2025-06-09 12:06:51.699476"]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.781721"], ["updated_at", "2025-06-09 12:06:51.781721"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.781898"], ["updated_at", "2025-06-09 12:06:51.781898"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.781733"], ["updated_at", "2025-06-09 12:06:51.781733"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.781752"], ["updated_at", "2025-06-09 12:06:51.781752"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.781807"], ["updated_at", "2025-06-09 12:06:51.781807"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.783476"], ["updated_at", "2025-06-09 12:06:51.783476"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.783671"], ["updated_at", "2025-06-09 12:06:51.783671"]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:06:51.784758"], ["updated_at", "2025-06-09 12:06:51.784758"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:06:51.785973"], ["updated_at", "2025-06-09 12:06:51.785973"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 7], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:06:51.786148"], ["updated_at", "2025-06-09 12:06:51.786148"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.786460"], ["updated_at", "2025-06-09 12:06:51.786460"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.786991"], ["updated_at", "2025-06-09 12:06:51.786991"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 6], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 7], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.788506"], ["updated_at", "2025-06-09 12:06:51.788506"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
TvShowTest: test_should_have_many_episodes
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.788950"], ["updated_at", "2025-06-09 12:06:51.788950"]]
------------------------------------------
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.790726"], ["updated_at", "2025-06-09 12:06:51.790726"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.790477"], ["updated_at", "2025-06-09 12:06:51.790477"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.790888"], ["updated_at", "2025-06-09 12:06:51.790888"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:06:51.791012"], ["updated_at", "2025-06-09 12:06:51.791012"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.792253"], ["updated_at", "2025-06-09 12:06:51.792253"]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_custom_parameters
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_handle_service_errors_gracefully
-------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.795034"], ["updated_at", "2025-06-09 12:06:51.795034"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.795758"], ["updated_at", "2025-06-09 12:06:51.795758"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 8], ["id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.796691"], ["updated_at", "2025-06-09 12:06:51.796691"]]
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.797782"], ["updated_at", "2025-06-09 12:06:51.797782"]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.797611"], ["updated_at", "2025-06-09 12:06:51.797611"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.798518"], ["updated_at", "2025-06-09 12:06:51.798518"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.798754"], ["updated_at", "2025-06-09 12:06:51.798754"]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.799724"], ["updated_at", "2025-06-09 12:06:51.799724"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.799716"], ["updated_at", "2025-06-09 12:06:51.799716"]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.800497"], ["updated_at", "2025-06-09 12:06:51.800497"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.800839"], ["updated_at", "2025-06-09 12:06:51.800839"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.801244"], ["updated_at", "2025-06-09 12:06:51.801244"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.801571"], ["updated_at", "2025-06-09 12:06:51.801571"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.803351"], ["updated_at", "2025-06-09 12:06:51.803351"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:06:51.804424"], ["updated_at", "2025-06-09 12:06:51.804424"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.804251"], ["updated_at", "2025-06-09 12:06:51.804251"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.804922"], ["updated_at", "2025-06-09 12:06:51.804922"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.805209"], ["updated_at", "2025-06-09 12:06:51.805209"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 6], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 5], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 3], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 6], ["created_at", "2025-06-09 12:06:51.807422"], ["updated_at", "2025-06-09 12:06:51.807422"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.807202"], ["updated_at", "2025-06-09 12:06:51.807202"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 12:06:51.807477"], ["updated_at", "2025-06-09 12:06:51.807477"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.810138"], ["updated_at", "2025-06-09 12:06:51.810138"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.811266"], ["updated_at", "2025-06-09 12:06:51.811266"]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.811816"], ["updated_at", "2025-06-09 12:06:51.811816"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.812272"], ["updated_at", "2025-06-09 12:06:51.812272"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.812891"], ["updated_at", "2025-06-09 12:06:51.812891"]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.813274"], ["updated_at", "2025-06-09 12:06:51.813274"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:06:51.813689"], ["updated_at", "2025-06-09 12:06:51.813689"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.813798"], ["updated_at", "2025-06-09 12:06:51.813798"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.814686"], ["updated_at", "2025-06-09 12:06:51.814686"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.814922"], ["updated_at", "2025-06-09 12:06:51.814922"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.815000"], ["updated_at", "2025-06-09 12:06:51.815000"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.816771"], ["updated_at", "2025-06-09 12:06:51.816771"]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 12:06:51.817385"], ["updated_at", "2025-06-09 12:06:51.817385"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.817684"], ["updated_at", "2025-06-09 12:06:51.817684"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:06:51.818138"], ["updated_at", "2025-06-09 12:06:51.818138"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:06:51.818699"], ["updated_at", "2025-06-09 12:06:51.818699"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 2], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 5], ["created_at", "2025-06-09 12:06:51.820424"], ["updated_at", "2025-06-09 12:06:51.820424"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 4], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (26.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[35m (25.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[35m (30.9ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (26.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[35m (28.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (34.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (25.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_custom_parameters
---------------------------------------------------------------------------------
  [1m[35m (27.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (24.5ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_handle_service_errors_gracefully
-------------------------------------------------------------------------
  [1m[35m (25.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[35m (2.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (6.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mDistributor Create (5.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.688086"], ["updated_at", "2025-06-09 12:12:16.688086"]]
  [1m[36mDistributor Create (6.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.687592"], ["updated_at", "2025-06-09 12:12:16.687592"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (6.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.688947"], ["updated_at", "2025-06-09 12:12:16.688947"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (6.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.690507"], ["updated_at", "2025-06-09 12:12:16.690507"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (8.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.688916"], ["updated_at", "2025-06-09 12:12:16.688916"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.722351"], ["updated_at", "2025-06-09 12:12:16.722351"]]
  [1m[36mTvShow Create (1.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.725583"], ["updated_at", "2025-06-09 12:12:16.725583"]]
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.727264"], ["updated_at", "2025-06-09 12:12:16.727264"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (5.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.724898"], ["updated_at", "2025-06-09 12:12:16.724898"]]
  [1m[36mTvShow Create (2.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.729231"], ["updated_at", "2025-06-09 12:12:16.729231"]]
  [1m[36mTvShow Create (2.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.728658"], ["updated_at", "2025-06-09 12:12:16.728658"]]
  [1m[36mTvShow Create (2.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.728718"], ["updated_at", "2025-06-09 12:12:16.728718"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (1.6ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.737656"], ["updated_at", "2025-06-09 12:12:16.737656"]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 2], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Count (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 1], ["episode_number", 2], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:12:16.747746"], ["updated_at", "2025-06-09 12:12:16.747746"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.745945"], ["updated_at", "2025-06-09 12:12:16.745945"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (4.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Load (2.0ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.749769"], ["updated_at", "2025-06-09 12:12:16.749769"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.753058"], ["updated_at", "2025-06-09 12:12:16.753058"]]
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (4.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.750892"], ["updated_at", "2025-06-09 12:12:16.750892"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.756050"], ["updated_at", "2025-06-09 12:12:16.756050"]]
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (1.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.760127"], ["updated_at", "2025-06-09 12:12:16.760127"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (4.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 1], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:12:16.757599"], ["updated_at", "2025-06-09 12:12:16.757599"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (6.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.757992"], ["updated_at", "2025-06-09 12:12:16.757992"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.766099"], ["updated_at", "2025-06-09 12:12:16.766099"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 7], ["created_at", "2025-06-09 12:12:16.769229"], ["updated_at", "2025-06-09 12:12:16.769229"]]
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:12:16.769315"], ["updated_at", "2025-06-09 12:12:16.769315"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.767623"], ["updated_at", "2025-06-09 12:12:16.767623"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.772032"], ["updated_at", "2025-06-09 12:12:16.772032"]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:12:16.771584"], ["updated_at", "2025-06-09 12:12:16.771584"]]
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.5ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (4.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:12:16.776244"], ["updated_at", "2025-06-09 12:12:16.776244"]]
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 2], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:12:16.776098"], ["updated_at", "2025-06-09 12:12:16.776098"]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.776353"], ["updated_at", "2025-06-09 12:12:16.776353"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.769557"], ["updated_at", "2025-06-09 12:12:16.769557"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Load (1.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.778534"], ["updated_at", "2025-06-09 12:12:16.778534"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.780049"], ["updated_at", "2025-06-09 12:12:16.780049"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 7], ["id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:12:16.783572"], ["updated_at", "2025-06-09 12:12:16.783572"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.784818"], ["updated_at", "2025-06-09 12:12:16.784818"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.787042"], ["updated_at", "2025-06-09 12:12:16.787042"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (3.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:12:16.787082"], ["updated_at", "2025-06-09 12:12:16.787082"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (5.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 1], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.784877"], ["updated_at", "2025-06-09 12:12:16.784877"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTvShow Create (6.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.784322"], ["updated_at", "2025-06-09 12:12:16.784322"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (1.0ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 2], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.792173"], ["updated_at", "2025-06-09 12:12:16.792173"]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.796621"], ["updated_at", "2025-06-09 12:12:16.796621"]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 1], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.798047"], ["updated_at", "2025-06-09 12:12:16.798047"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.799881"], ["updated_at", "2025-06-09 12:12:16.799881"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.801450"], ["updated_at", "2025-06-09 12:12:16.801450"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (3.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:12:16.799543"], ["updated_at", "2025-06-09 12:12:16.799543"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Ingestion completed: 1 processed, 0 errors
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.802480"], ["updated_at", "2025-06-09 12:12:16.802480"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.804118"], ["updated_at", "2025-06-09 12:12:16.804118"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.807000"], ["updated_at", "2025-06-09 12:12:16.807000"]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.806742"], ["updated_at", "2025-06-09 12:12:16.806742"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.808461"], ["updated_at", "2025-06-09 12:12:16.808461"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (3.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 1], ["created_at", "2025-06-09 12:12:16.808708"], ["updated_at", "2025-06-09 12:12:16.808708"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.813618"], ["updated_at", "2025-06-09 12:12:16.813618"]]
  [1m[36mDistributor Load (1.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:12:16.828109"], ["updated_at", "2025-06-09 12:12:16.828109"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (1.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 6], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 2], ["created_at", "2025-06-09 12:12:16.832561"], ["updated_at", "2025-06-09 12:12:16.832561"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 6], ["created_at", "2025-06-09 12:12:16.838415"], ["updated_at", "2025-06-09 12:12:16.838415"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 8], ["created_at", "2025-06-09 12:12:16.849843"], ["updated_at", "2025-06-09 12:12:16.849843"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 1], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
-----------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mDistributor Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.903785"], ["updated_at", "2025-06-09 12:12:16.903785"]]
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Create (1.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.904449"], ["updated_at", "2025-06-09 12:12:16.904449"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.903336"], ["updated_at", "2025-06-09 12:12:16.903336"]]
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.906538"], ["updated_at", "2025-06-09 12:12:16.906538"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.908017"], ["updated_at", "2025-06-09 12:12:16.908017"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.9ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.910955"], ["updated_at", "2025-06-09 12:12:16.910955"]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.910892"], ["updated_at", "2025-06-09 12:12:16.910892"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (2.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.911399"], ["updated_at", "2025-06-09 12:12:16.911399"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.911743"], ["updated_at", "2025-06-09 12:12:16.911743"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.911649"], ["updated_at", "2025-06-09 12:12:16.911649"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:12:16.914956"], ["updated_at", "2025-06-09 12:12:16.914956"]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.919475"], ["updated_at", "2025-06-09 12:12:16.919475"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 2], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.919795"], ["updated_at", "2025-06-09 12:12:16.919795"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (6.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.918839"], ["updated_at", "2025-06-09 12:12:16.918839"]]
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (9.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (5.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.921402"], ["updated_at", "2025-06-09 12:12:16.921402"]]
  [1m[36mDistributor Create (2.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:12:16.928393"], ["updated_at", "2025-06-09 12:12:16.928393"]]
  [1m[36mEpisode Create (10.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.922450"], ["updated_at", "2025-06-09 12:12:16.922450"]]
  [1m[36mTRANSACTION (11.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (13.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.928425"], ["updated_at", "2025-06-09 12:12:16.928425"]]
  [1m[36mTRANSACTION (11.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (10.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (4.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 3], ["id", 3], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (7.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.947597"], ["updated_at", "2025-06-09 12:12:16.947597"]]
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Count (6.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.956455"], ["updated_at", "2025-06-09 12:12:16.956455"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Load (0.5ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.959069"], ["updated_at", "2025-06-09 12:12:16.959069"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.964004"], ["updated_at", "2025-06-09 12:12:16.964004"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mReleaseDate Create (1.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 2], ["created_at", "2025-06-09 12:12:16.965099"], ["updated_at", "2025-06-09 12:12:16.965099"]]
  [1m[36mReleaseDate Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 12:12:16.968351"], ["updated_at", "2025-06-09 12:12:16.968351"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.968504"], ["updated_at", "2025-06-09 12:12:16.968504"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (1.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 12:12:16.969503"], ["updated_at", "2025-06-09 12:12:16.969503"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.8ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 2], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:12:16.974792"], ["updated_at", "2025-06-09 12:12:16.974792"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.984513"], ["updated_at", "2025-06-09 12:12:16.984513"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.984997"], ["updated_at", "2025-06-09 12:12:16.984997"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.985294"], ["updated_at", "2025-06-09 12:12:16.985294"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.985596"], ["updated_at", "2025-06-09 12:12:16.985596"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.987524"], ["updated_at", "2025-06-09 12:12:16.987524"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.987685"], ["updated_at", "2025-06-09 12:12:16.987685"]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.988351"], ["updated_at", "2025-06-09 12:12:16.988351"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.987582"], ["updated_at", "2025-06-09 12:12:16.987582"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:12:16.991384"], ["updated_at", "2025-06-09 12:12:16.991384"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.993193"], ["updated_at", "2025-06-09 12:12:16.993193"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.994424"], ["updated_at", "2025-06-09 12:12:16.994424"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:16.997878"], ["updated_at", "2025-06-09 12:12:16.997878"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 6], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:12:16.999432"], ["updated_at", "2025-06-09 12:12:16.999432"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 11], ["id", 8], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.002120"], ["updated_at", "2025-06-09 12:12:17.002120"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.004257"], ["updated_at", "2025-06-09 12:12:17.004257"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.004094"], ["updated_at", "2025-06-09 12:12:17.004094"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.004473"], ["updated_at", "2025-06-09 12:12:17.004473"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (30.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:12:17.022462"], ["updated_at", "2025-06-09 12:12:17.022462"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 11], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.056361"], ["updated_at", "2025-06-09 12:12:17.056361"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.056431"], ["updated_at", "2025-06-09 12:12:17.056431"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.056351"], ["updated_at", "2025-06-09 12:12:17.056351"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.056468"], ["updated_at", "2025-06-09 12:12:17.056468"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.058350"], ["updated_at", "2025-06-09 12:12:17.058350"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.058304"], ["updated_at", "2025-06-09 12:12:17.058304"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.058394"], ["updated_at", "2025-06-09 12:12:17.058394"]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.058459"], ["updated_at", "2025-06-09 12:12:17.058459"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.061241"], ["updated_at", "2025-06-09 12:12:17.061241"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.061382"], ["updated_at", "2025-06-09 12:12:17.061382"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.061479"], ["updated_at", "2025-06-09 12:12:17.061479"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.061594"], ["updated_at", "2025-06-09 12:12:17.061594"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 9], ["created_at", "2025-06-09 12:12:17.063631"], ["updated_at", "2025-06-09 12:12:17.063631"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 12:12:17.063967"], ["updated_at", "2025-06-09 12:12:17.063967"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.063899"], ["updated_at", "2025-06-09 12:12:17.063899"]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 9], ["created_at", "2025-06-09 12:12:17.064077"], ["updated_at", "2025-06-09 12:12:17.064077"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 12:12:17.064527"], ["updated_at", "2025-06-09 12:12:17.064527"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.065774"], ["updated_at", "2025-06-09 12:12:17.065774"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.069818"], ["updated_at", "2025-06-09 12:12:17.069818"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 12:12:17.072901"], ["updated_at", "2025-06-09 12:12:17.072901"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Completed 400 Bad Request in 9ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 400 Bad Request in 9ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (2.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.121733"], ["updated_at", "2025-06-09 12:12:17.121733"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.121758"], ["updated_at", "2025-06-09 12:12:17.121758"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.123886"], ["updated_at", "2025-06-09 12:12:17.123886"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.123929"], ["updated_at", "2025-06-09 12:12:17.123929"]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 4]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 9]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 7]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.127218"], ["updated_at", "2025-06-09 12:12:17.127218"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.127202"], ["updated_at", "2025-06-09 12:12:17.127202"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.4ms | ActiveRecord: 4.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 12:12:17.129370"], ["updated_at", "2025-06-09 12:12:17.129370"]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 12:12:17.129376"], ["updated_at", "2025-06-09 12:12:17.129376"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 24ms (Views: 0.4ms | ActiveRecord: 4.6ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 4.6ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.137390"], ["updated_at", "2025-06-09 12:12:17.137390"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.140225"], ["updated_at", "2025-06-09 12:12:17.140225"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:12:17.142794"], ["updated_at", "2025-06-09 12:12:17.142794"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 10]]
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 4]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 5.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:12:17.144769"], ["updated_at", "2025-06-09 12:12:17.144769"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
Completed 200 OK in 16ms (Views: 0.2ms | ActiveRecord: 4.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35mSQL (0.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:12:17 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 5]]
  [1m[35mSQL (0.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 2.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (6.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (7.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (6.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (57.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (61.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (5.8ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (68.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (65.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[35m (3.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (69.7ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (60.0ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (60.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (58.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[35m (48.2ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
  [1m[35m (54.0ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_handle_service_errors_gracefully
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_custom_parameters
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
---------------------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
EpisodeTest: test_by_season_scope_should_filter_by_season
------------------------------------------
---------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (4.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (5.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (10.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.500219"], ["updated_at", "2025-06-09 12:14:46.500219"]]
  [1m[36mDistributor Create (10.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.500523"], ["updated_at", "2025-06-09 12:14:46.500523"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (11.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.503547"], ["updated_at", "2025-06-09 12:14:46.503547"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.519051"], ["updated_at", "2025-06-09 12:14:46.519051"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (7.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.519130"], ["updated_at", "2025-06-09 12:14:46.519130"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (9.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (7.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.540138"], ["updated_at", "2025-06-09 12:14:46.540138"]]
  [1m[36mTvShow Exists? (4.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (4.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.547406"], ["updated_at", "2025-06-09 12:14:46.547406"]]
  [1m[36mTvShow Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (5.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.551182"], ["updated_at", "2025-06-09 12:14:46.551182"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (8.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.553774"], ["updated_at", "2025-06-09 12:14:46.553774"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (3.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.563470"], ["updated_at", "2025-06-09 12:14:46.563470"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (3.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.564344"], ["updated_at", "2025-06-09 12:14:46.564344"]]
  [1m[36mDistributor Exists? (3.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.569873"], ["updated_at", "2025-06-09 12:14:46.569873"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.577084"], ["updated_at", "2025-06-09 12:14:46.577084"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (2.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.576679"], ["updated_at", "2025-06-09 12:14:46.576679"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 8], ["LIMIT", 1]]
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.583606"], ["updated_at", "2025-06-09 12:14:46.583606"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (1.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.587871"], ["updated_at", "2025-06-09 12:14:46.587871"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.587598"], ["updated_at", "2025-06-09 12:14:46.587598"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.592433"], ["updated_at", "2025-06-09 12:14:46.592433"]]
  [1m[36mDistributor Create (5.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.586794"], ["updated_at", "2025-06-09 12:14:46.586794"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.594627"], ["updated_at", "2025-06-09 12:14:46.594627"]]
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.595308"], ["updated_at", "2025-06-09 12:14:46.595308"]]
  [1m[36mEpisode Count (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.595560"], ["updated_at", "2025-06-09 12:14:46.595560"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.598664"], ["updated_at", "2025-06-09 12:14:46.598664"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.600570"], ["updated_at", "2025-06-09 12:14:46.600570"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:14:46.601402"], ["updated_at", "2025-06-09 12:14:46.601402"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 5], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:14:46.603100"], ["updated_at", "2025-06-09 12:14:46.603100"]]
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.605462"], ["updated_at", "2025-06-09 12:14:46.605462"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.605982"], ["updated_at", "2025-06-09 12:14:46.605982"]]
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.603641"], ["updated_at", "2025-06-09 12:14:46.603641"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.607977"], ["updated_at", "2025-06-09 12:14:46.607977"]]
  [1m[36mTvShow Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.607919"], ["updated_at", "2025-06-09 12:14:46.607919"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.612483"], ["updated_at", "2025-06-09 12:14:46.612483"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.613469"], ["updated_at", "2025-06-09 12:14:46.613469"]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 5], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:14:46.613365"], ["updated_at", "2025-06-09 12:14:46.613365"]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.613588"], ["updated_at", "2025-06-09 12:14:46.613588"]]
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.614553"], ["updated_at", "2025-06-09 12:14:46.614553"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.614130"], ["updated_at", "2025-06-09 12:14:46.614130"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.615615"], ["updated_at", "2025-06-09 12:14:46.615615"]]
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.620560"], ["updated_at", "2025-06-09 12:14:46.620560"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.615506"], ["updated_at", "2025-06-09 12:14:46.615506"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:14:46.621820"], ["updated_at", "2025-06-09 12:14:46.621820"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 20], ["id", 11], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 11], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.625334"], ["updated_at", "2025-06-09 12:14:46.625334"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (5.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.623378"], ["updated_at", "2025-06-09 12:14:46.623378"]]
  [1m[36mEpisode Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:14:46.629409"], ["updated_at", "2025-06-09 12:14:46.629409"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 3], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 14], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mEpisode Create (3.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 3], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.634077"], ["updated_at", "2025-06-09 12:14:46.634077"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (5.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.636171"], ["updated_at", "2025-06-09 12:14:46.636171"]]
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.8ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTvShow Exists? (4.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 3], ["created_at", "2025-06-09 12:14:46.654859"], ["updated_at", "2025-06-09 12:14:46.654859"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (2.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:14:46.654710"], ["updated_at", "2025-06-09 12:14:46.654710"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (4.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.654328"], ["updated_at", "2025-06-09 12:14:46.654328"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 3], ["id", 3], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.678959"], ["updated_at", "2025-06-09 12:14:46.678959"]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.679202"], ["updated_at", "2025-06-09 12:14:46.679202"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.679360"], ["updated_at", "2025-06-09 12:14:46.679360"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.679833"], ["updated_at", "2025-06-09 12:14:46.679833"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.680724"], ["updated_at", "2025-06-09 12:14:46.680724"]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.681170"], ["updated_at", "2025-06-09 12:14:46.681170"]]
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.681938"], ["updated_at", "2025-06-09 12:14:46.681938"]]
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.682220"], ["updated_at", "2025-06-09 12:14:46.682220"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.683447"], ["updated_at", "2025-06-09 12:14:46.683447"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.684142"], ["updated_at", "2025-06-09 12:14:46.684142"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.682720"], ["updated_at", "2025-06-09 12:14:46.682720"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.683786"], ["updated_at", "2025-06-09 12:14:46.683786"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.681603"], ["updated_at", "2025-06-09 12:14:46.681603"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.687037"], ["updated_at", "2025-06-09 12:14:46.687037"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.689395"], ["updated_at", "2025-06-09 12:14:46.689395"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.689739"], ["updated_at", "2025-06-09 12:14:46.689739"]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.689296"], ["updated_at", "2025-06-09 12:14:46.689296"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.689448"], ["updated_at", "2025-06-09 12:14:46.689448"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.689949"], ["updated_at", "2025-06-09 12:14:46.689949"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (5.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 3], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (2.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 12:14:46.703221"], ["updated_at", "2025-06-09 12:14:46.703221"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 12:14:46.706386"], ["updated_at", "2025-06-09 12:14:46.706386"]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.707584"], ["updated_at", "2025-06-09 12:14:46.707584"]]
  [1m[36mReleaseDate Create (1.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 12:14:46.706499"], ["updated_at", "2025-06-09 12:14:46.706499"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (2.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 3], ["created_at", "2025-06-09 12:14:46.706443"], ["updated_at", "2025-06-09 12:14:46.706443"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 12:14:46.707501"], ["updated_at", "2025-06-09 12:14:46.707501"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (4.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.711987"], ["updated_at", "2025-06-09 12:14:46.711987"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:14:46.712174"], ["updated_at", "2025-06-09 12:14:46.712174"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.713795"], ["updated_at", "2025-06-09 12:14:46.713795"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.717502"], ["updated_at", "2025-06-09 12:14:46.717502"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.717747"], ["updated_at", "2025-06-09 12:14:46.717747"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 4], ["LIMIT", 1]]
  [1m[36mEpisode Create (11.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 4], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.722404"], ["updated_at", "2025-06-09 12:14:46.722404"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
  [1m[36mReleaseDate Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 12:14:46.740864"], ["updated_at", "2025-06-09 12:14:46.740864"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 7], ["LIMIT", 1]]
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[36mReleaseDate Create (2.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 12:14:46.745770"], ["updated_at", "2025-06-09 12:14:46.745770"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 8ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 400 Bad Request in 9ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 12]]
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 6]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 5]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 6]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 4.6ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 26ms (Views: 0.4ms | ActiveRecord: 4.5ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 4.3ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 3.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 4]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
----------------------------------------------------------------------------------
-----------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
DistributorTest: test_should_have_many_tv_shows
----------------------------------------------------------------------------------
--------------------------------------------------------------------------
-----------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
Completed 200 OK in 19ms (Views: 0.3ms | ActiveRecord: 3.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (3.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.794491"], ["updated_at", "2025-06-09 12:14:46.794491"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.795058"], ["updated_at", "2025-06-09 12:14:46.795058"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:14:46 +0100
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 7]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.796798"], ["updated_at", "2025-06-09 12:14:46.796798"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.797806"], ["updated_at", "2025-06-09 12:14:46.797806"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[35mSQL (1.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mDistributor Load (0.6ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 20], ["id", 16], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 5.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.805955"], ["updated_at", "2025-06-09 12:14:46.805955"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:14:46.808593"], ["updated_at", "2025-06-09 12:14:46.808593"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 8], ["LIMIT", 1]]
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (1.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.814893"], ["updated_at", "2025-06-09 12:14:46.814893"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.814978"], ["updated_at", "2025-06-09 12:14:46.814978"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.815028"], ["updated_at", "2025-06-09 12:14:46.815028"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.815291"], ["updated_at", "2025-06-09 12:14:46.815291"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:14:46.816117"], ["updated_at", "2025-06-09 12:14:46.816117"]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.816913"], ["updated_at", "2025-06-09 12:14:46.816913"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.816915"], ["updated_at", "2025-06-09 12:14:46.816915"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.816994"], ["updated_at", "2025-06-09 12:14:46.816994"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.817066"], ["updated_at", "2025-06-09 12:14:46.817066"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.820621"], ["updated_at", "2025-06-09 12:14:46.820621"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.820641"], ["updated_at", "2025-06-09 12:14:46.820641"]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.820805"], ["updated_at", "2025-06-09 12:14:46.820805"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 5], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.820862"], ["updated_at", "2025-06-09 12:14:46.820862"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.821280"], ["updated_at", "2025-06-09 12:14:46.821280"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.822702"], ["updated_at", "2025-06-09 12:14:46.822702"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:14:46.823474"], ["updated_at", "2025-06-09 12:14:46.823474"]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 4], ["created_at", "2025-06-09 12:14:46.823423"], ["updated_at", "2025-06-09 12:14:46.823423"]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 13], ["created_at", "2025-06-09 12:14:46.823515"], ["updated_at", "2025-06-09 12:14:46.823515"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.825761"], ["updated_at", "2025-06-09 12:14:46.825761"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 4], ["created_at", "2025-06-09 12:14:46.825885"], ["updated_at", "2025-06-09 12:14:46.825885"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (0.2ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 5], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.826177"], ["updated_at", "2025-06-09 12:14:46.826177"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.827069"], ["updated_at", "2025-06-09 12:14:46.827069"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 7], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.827507"], ["updated_at", "2025-06-09 12:14:46.827507"]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.829067"], ["updated_at", "2025-06-09 12:14:46.829067"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.829999"], ["updated_at", "2025-06-09 12:14:46.829999"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.830773"], ["updated_at", "2025-06-09 12:14:46.830773"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.830793"], ["updated_at", "2025-06-09 12:14:46.830793"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.831206"], ["updated_at", "2025-06-09 12:14:46.831206"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.831718"], ["updated_at", "2025-06-09 12:14:46.831718"]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.832242"], ["updated_at", "2025-06-09 12:14:46.832242"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 9], ["created_at", "2025-06-09 12:14:46.832909"], ["updated_at", "2025-06-09 12:14:46.832909"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.832644"], ["updated_at", "2025-06-09 12:14:46.832644"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.832869"], ["updated_at", "2025-06-09 12:14:46.832869"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
------------------------------------------------------------------------------------------
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 6], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.834950"], ["updated_at", "2025-06-09 12:14:46.834950"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.835726"], ["updated_at", "2025-06-09 12:14:46.835726"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Starting ingestion of upcoming episodes for 90 days
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:14:46.836125"], ["updated_at", "2025-06-09 12:14:46.836125"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 6], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 5], ["created_at", "2025-06-09 12:14:46.837896"], ["updated_at", "2025-06-09 12:14:46.837896"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 8], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:14:46.838890"], ["updated_at", "2025-06-09 12:14:46.838890"]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 8], ["created_at", "2025-06-09 12:14:46.839693"], ["updated_at", "2025-06-09 12:14:46.839693"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:14:46.841153"], ["updated_at", "2025-06-09 12:14:46.841153"]]
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
Starting ingestion of upcoming episodes for 90 days
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:14:46.843950"], ["updated_at", "2025-06-09 12:14:46.843950"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 19], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:14:46.844587"], ["updated_at", "2025-06-09 12:14:46.844587"]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 15], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:14:46.845661"], ["updated_at", "2025-06-09 12:14:46.845661"]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 12:14:46.846970"], ["updated_at", "2025-06-09 12:14:46.846970"]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mDistributor Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:14:46.848462"], ["updated_at", "2025-06-09 12:14:46.848462"]]
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 6], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 6], ["created_at", "2025-06-09 12:14:46.850619"], ["updated_at", "2025-06-09 12:14:46.850619"]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 6], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 6], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 6], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (28.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[35m (33.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (33.6ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (41.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (41.0ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[35m (42.5ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (35.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (39.9ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[35m (42.0ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (36.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_custom_parameters
---------------------------------------------------------------------------------
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_handle_service_errors_gracefully
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
Starting ingestion of upcoming episodes for 90 days
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mDistributor Exists? (5.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (5.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (9.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.728655"], ["updated_at", "2025-06-09 12:15:36.728655"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (1.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Load (2.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.735810"], ["updated_at", "2025-06-09 12:15:36.735810"]]
  [1m[36mDistributor Create (3.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.736468"], ["updated_at", "2025-06-09 12:15:36.736468"]]
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (4.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.758066"], ["updated_at", "2025-06-09 12:15:36.758066"]]
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:15:36.760184"], ["updated_at", "2025-06-09 12:15:36.760184"]]
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (7.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:15:36.764657"], ["updated_at", "2025-06-09 12:15:36.764657"]]
  [1m[36mTvShow Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (7.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.765841"], ["updated_at", "2025-06-09 12:15:36.765841"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (5.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Count (5.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mDistributor Create (8.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.768576"], ["updated_at", "2025-06-09 12:15:36.768576"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (3.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.9ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (8.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.774803"], ["updated_at", "2025-06-09 12:15:36.774803"]]
  [1m[36mTvShow Create (6.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.778502"], ["updated_at", "2025-06-09 12:15:36.778502"]]
  [1m[36mDistributor Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Load (1.8ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (6.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.787900"], ["updated_at", "2025-06-09 12:15:36.787900"]]
  [1m[36mTvShow Create (4.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:15:36.792020"], ["updated_at", "2025-06-09 12:15:36.792020"]]
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (5.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 24], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:15:36.789938"], ["updated_at", "2025-06-09 12:15:36.789938"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Exists? (5.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.799401"], ["updated_at", "2025-06-09 12:15:36.799401"]]
  [1m[36mTvShow Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 22], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:15:36.798943"], ["updated_at", "2025-06-09 12:15:36.798943"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.801626"], ["updated_at", "2025-06-09 12:15:36.801626"]]
  [1m[36mTvShow Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 23], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (4.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (4.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.802748"], ["updated_at", "2025-06-09 12:15:36.802748"]]
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.809343"], ["updated_at", "2025-06-09 12:15:36.809343"]]
  [1m[36mTvShow Create (3.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 8], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:15:36.806778"], ["updated_at", "2025-06-09 12:15:36.806778"]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:15:36.809966"], ["updated_at", "2025-06-09 12:15:36.809966"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (2.0ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.813405"], ["updated_at", "2025-06-09 12:15:36.813405"]]
  [1m[36mDistributor Create (3.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.809113"], ["updated_at", "2025-06-09 12:15:36.809113"]]
  [1m[36mTvShow Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (1.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.814047"], ["updated_at", "2025-06-09 12:15:36.814047"]]
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 15], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.817276"], ["updated_at", "2025-06-09 12:15:36.817276"]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Load (1.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.818670"], ["updated_at", "2025-06-09 12:15:36.818670"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.819586"], ["updated_at", "2025-06-09 12:15:36.819586"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (3.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.826442"], ["updated_at", "2025-06-09 12:15:36.826442"]]
  [1m[36mEpisode Create (2.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:15:36.825023"], ["updated_at", "2025-06-09 12:15:36.825023"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (1.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.827640"], ["updated_at", "2025-06-09 12:15:36.827640"]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (6.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.824516"], ["updated_at", "2025-06-09 12:15:36.824516"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.832953"], ["updated_at", "2025-06-09 12:15:36.832953"]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.832799"], ["updated_at", "2025-06-09 12:15:36.832799"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.833167"], ["updated_at", "2025-06-09 12:15:36.833167"]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (3.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.831254"], ["updated_at", "2025-06-09 12:15:36.831254"]]
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 7], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:15:36.834817"], ["updated_at", "2025-06-09 12:15:36.834817"]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (1.0ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 7], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.7ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.839347"], ["updated_at", "2025-06-09 12:15:36.839347"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 7], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:15:36.842892"], ["updated_at", "2025-06-09 12:15:36.842892"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.842912"], ["updated_at", "2025-06-09 12:15:36.842912"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 12:15:36.844689"], ["updated_at", "2025-06-09 12:15:36.844689"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (1.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 7], ["id", 7], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.849251"], ["updated_at", "2025-06-09 12:15:36.849251"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.850358"], ["updated_at", "2025-06-09 12:15:36.850358"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.849719"], ["updated_at", "2025-06-09 12:15:36.849719"]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 12:15:36.850606"], ["updated_at", "2025-06-09 12:15:36.850606"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.850579"], ["updated_at", "2025-06-09 12:15:36.850579"]]
Ingestion completed: 1 processed, 0 errors
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.852079"], ["updated_at", "2025-06-09 12:15:36.852079"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.854640"], ["updated_at", "2025-06-09 12:15:36.854640"]]
  [1m[36mDistributor Count (2.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.854356"], ["updated_at", "2025-06-09 12:15:36.854356"]]
  [1m[36mTvShow Create (2.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.853454"], ["updated_at", "2025-06-09 12:15:36.853454"]]
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.857464"], ["updated_at", "2025-06-09 12:15:36.857464"]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 7], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.866720"], ["updated_at", "2025-06-09 12:15:36.866720"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 11], ["created_at", "2025-06-09 12:15:36.867912"], ["updated_at", "2025-06-09 12:15:36.867912"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 12:15:36.871626"], ["updated_at", "2025-06-09 12:15:36.871626"]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.874467"], ["updated_at", "2025-06-09 12:15:36.874467"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 8], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.875208"], ["updated_at", "2025-06-09 12:15:36.875208"]]
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
-----------------------------------------------------------
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 13], ["created_at", "2025-06-09 12:15:36.891112"], ["updated_at", "2025-06-09 12:15:36.891112"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.893553"], ["updated_at", "2025-06-09 12:15:36.893553"]]
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (32.7ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (6.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 12:15:36.900978"], ["updated_at", "2025-06-09 12:15:36.900978"]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.901423"], ["updated_at", "2025-06-09 12:15:36.901423"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
  [1m[36mReleaseDate Create (1.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 8], ["created_at", "2025-06-09 12:15:36.900355"], ["updated_at", "2025-06-09 12:15:36.900355"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (1.0ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Count (2.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mEpisode Exists? (35.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 7], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 6], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (1.0ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 11], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (6.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 6], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (7.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (3.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 7], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (1.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.910353"], ["updated_at", "2025-06-09 12:15:36.910353"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 16], ["created_at", "2025-06-09 12:15:36.913747"], ["updated_at", "2025-06-09 12:15:36.913747"]]
  [1m[36mReleaseDate Create (2.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 6], ["created_at", "2025-06-09 12:15:36.912520"], ["updated_at", "2025-06-09 12:15:36.912520"]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.913542"], ["updated_at", "2025-06-09 12:15:36.913542"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:15:36.878500"], ["updated_at", "2025-06-09 12:15:36.878500"]]
-------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.917490"], ["updated_at", "2025-06-09 12:15:36.917490"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 9], ["LIMIT", 1]]
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.920154"], ["updated_at", "2025-06-09 12:15:36.920154"]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.920079"], ["updated_at", "2025-06-09 12:15:36.920079"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 8], ["LIMIT", 1]]
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mDistributor Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 11], ["created_at", "2025-06-09 12:15:36.922098"], ["updated_at", "2025-06-09 12:15:36.922098"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.923327"], ["updated_at", "2025-06-09 12:15:36.923327"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.923796"], ["updated_at", "2025-06-09 12:15:36.923796"]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.923630"], ["updated_at", "2025-06-09 12:15:36.923630"]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.923768"], ["updated_at", "2025-06-09 12:15:36.923768"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.925022"], ["updated_at", "2025-06-09 12:15:36.925022"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.926699"], ["updated_at", "2025-06-09 12:15:36.926699"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.927697"], ["updated_at", "2025-06-09 12:15:36.927697"]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.930072"], ["updated_at", "2025-06-09 12:15:36.930072"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:15:36.929769"], ["updated_at", "2025-06-09 12:15:36.929769"]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.932153"], ["updated_at", "2025-06-09 12:15:36.932153"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.932940"], ["updated_at", "2025-06-09 12:15:36.932940"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.933681"], ["updated_at", "2025-06-09 12:15:36.933681"]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.934590"], ["updated_at", "2025-06-09 12:15:36.934590"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 15], ["created_at", "2025-06-09 12:15:36.934844"], ["updated_at", "2025-06-09 12:15:36.934844"]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.934509"], ["updated_at", "2025-06-09 12:15:36.934509"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.935474"], ["updated_at", "2025-06-09 12:15:36.935474"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.936641"], ["updated_at", "2025-06-09 12:15:36.936641"]]
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 12:15:36.937973"], ["updated_at", "2025-06-09 12:15:36.937973"]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.937176"], ["updated_at", "2025-06-09 12:15:36.937176"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.938774"], ["updated_at", "2025-06-09 12:15:36.938774"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.939660"], ["updated_at", "2025-06-09 12:15:36.939660"]]
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.940299"], ["updated_at", "2025-06-09 12:15:36.940299"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.940823"], ["updated_at", "2025-06-09 12:15:36.940823"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 13], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.942549"], ["updated_at", "2025-06-09 12:15:36.942549"]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.942596"], ["updated_at", "2025-06-09 12:15:36.942596"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.943113"], ["updated_at", "2025-06-09 12:15:36.943113"]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:15:36.943370"], ["updated_at", "2025-06-09 12:15:36.943370"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.944888"], ["updated_at", "2025-06-09 12:15:36.944888"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.945874"], ["updated_at", "2025-06-09 12:15:36.945874"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:15:36.946868"], ["updated_at", "2025-06-09 12:15:36.946868"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.947611"], ["updated_at", "2025-06-09 12:15:36.947611"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 8], ["created_at", "2025-06-09 12:15:36.949784"], ["updated_at", "2025-06-09 12:15:36.949784"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 11], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:15:36.949575"], ["updated_at", "2025-06-09 12:15:36.949575"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 8], ["id", 4], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.967924"], ["updated_at", "2025-06-09 12:15:36.967924"]]
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.971368"], ["updated_at", "2025-06-09 12:15:36.971368"]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:15:36.971853"], ["updated_at", "2025-06-09 12:15:36.971853"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 13], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 14], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:15:36.982809"], ["updated_at", "2025-06-09 12:15:36.982809"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.990790"], ["updated_at", "2025-06-09 12:15:36.990790"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.991550"], ["updated_at", "2025-06-09 12:15:36.991550"]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.993330"], ["updated_at", "2025-06-09 12:15:36.993330"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.995716"], ["updated_at", "2025-06-09 12:15:36.995716"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.995805"], ["updated_at", "2025-06-09 12:15:36.995805"]]
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.996152"], ["updated_at", "2025-06-09 12:15:36.996152"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.996438"], ["updated_at", "2025-06-09 12:15:36.996438"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.996979"], ["updated_at", "2025-06-09 12:15:36.996979"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.996958"], ["updated_at", "2025-06-09 12:15:36.996958"]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.997312"], ["updated_at", "2025-06-09 12:15:36.997312"]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.997695"], ["updated_at", "2025-06-09 12:15:36.997695"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.998086"], ["updated_at", "2025-06-09 12:15:36.998086"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.998711"], ["updated_at", "2025-06-09 12:15:36.998711"]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.999281"], ["updated_at", "2025-06-09 12:15:36.999281"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.998831"], ["updated_at", "2025-06-09 12:15:36.998831"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.999448"], ["updated_at", "2025-06-09 12:15:36.999448"]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:36.999141"], ["updated_at", "2025-06-09 12:15:36.999141"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.000141"], ["updated_at", "2025-06-09 12:15:37.000141"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.001727"], ["updated_at", "2025-06-09 12:15:37.001727"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 15], ["id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.004020"], ["updated_at", "2025-06-09 12:15:37.004020"]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.004002"], ["updated_at", "2025-06-09 12:15:37.004002"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 9], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.005062"], ["updated_at", "2025-06-09 12:15:37.005062"]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.004977"], ["updated_at", "2025-06-09 12:15:37.004977"]]
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.004353"], ["updated_at", "2025-06-09 12:15:37.004353"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.005422"], ["updated_at", "2025-06-09 12:15:37.005422"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 9], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.006032"], ["updated_at", "2025-06-09 12:15:37.006032"]]
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 12:15:37.007191"], ["updated_at", "2025-06-09 12:15:37.007191"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 18], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:15:37.007224"], ["updated_at", "2025-06-09 12:15:37.007224"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 12:15:37.007792"], ["updated_at", "2025-06-09 12:15:37.007792"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 13], ["created_at", "2025-06-09 12:15:37.007760"], ["updated_at", "2025-06-09 12:15:37.007760"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 18], ["created_at", "2025-06-09 12:15:37.008457"], ["updated_at", "2025-06-09 12:15:37.008457"]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 12:15:37.008059"], ["updated_at", "2025-06-09 12:15:37.008059"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 7], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 12:15:37.010408"], ["updated_at", "2025-06-09 12:15:37.010408"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 7], ["created_at", "2025-06-09 12:15:37.010928"], ["updated_at", "2025-06-09 12:15:37.010928"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 9], ["created_at", "2025-06-09 12:15:37.010613"], ["updated_at", "2025-06-09 12:15:37.010613"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
Completed 400 Bad Request in 10ms (Views: 0.4ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 400 Bad Request in 8ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
---------------------------------------------------------------------
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 13]]
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 10]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 12]]
  [1m[35mSQL (2.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 16]]
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 9]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 7]]
Completed 200 OK in 22ms (Views: 0.4ms | ActiveRecord: 4.9ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 4.5ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 24ms (Views: 0.3ms | ActiveRecord: 4.5ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 27ms (Views: 0.4ms | ActiveRecord: 4.4ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 27ms (Views: 0.4ms | ActiveRecord: 4.4ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 27ms (Views: 0.4ms | ActiveRecord: 4.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:15:37 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (0.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (9.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.1ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (50.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (52.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (39.0ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (39.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (37.9ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (4.6ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (36.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (43.9ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (4.6ms)[0m  [1m[35mCOMMIT[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[35m (45.9ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (48.1ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[35m (40.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (4.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.574953"], ["updated_at", "2025-06-09 12:16:10.574953"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mDistributor Create (8.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.577850"], ["updated_at", "2025-06-09 12:16:10.577850"]]
  [1m[36mDistributor Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mDistributor Create (3.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.592260"], ["updated_at", "2025-06-09 12:16:10.592260"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.625329"], ["updated_at", "2025-06-09 12:16:10.625329"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (5.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.633154"], ["updated_at", "2025-06-09 12:16:10.633154"]]
  [1m[36mDistributor Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.639051"], ["updated_at", "2025-06-09 12:16:10.639051"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (6.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.642550"], ["updated_at", "2025-06-09 12:16:10.642550"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (2.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.648726"], ["updated_at", "2025-06-09 12:16:10.648726"]]
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (2.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.653986"], ["updated_at", "2025-06-09 12:16:10.653986"]]
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (2.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.658942"], ["updated_at", "2025-06-09 12:16:10.658942"]]
  [1m[36mDistributor Create (2.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.658923"], ["updated_at", "2025-06-09 12:16:10.658923"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.660218"], ["updated_at", "2025-06-09 12:16:10.660218"]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.669391"], ["updated_at", "2025-06-09 12:16:10.669391"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 10], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:16:10.676807"], ["updated_at", "2025-06-09 12:16:10.676807"]]
-----------------------------------------------------------------------------------
------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
EpisodeTest: test_should_require_tvmaze_id
-----------------------------------------------------------------------------------
------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.679956"], ["updated_at", "2025-06-09 12:16:10.679956"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 9], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.676142"], ["updated_at", "2025-06-09 12:16:10.676142"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.682207"], ["updated_at", "2025-06-09 12:16:10.682207"]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.682856"], ["updated_at", "2025-06-09 12:16:10.682856"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.681438"], ["updated_at", "2025-06-09 12:16:10.681438"]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.686952"], ["updated_at", "2025-06-09 12:16:10.686952"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.687735"], ["updated_at", "2025-06-09 12:16:10.687735"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 28], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.690395"], ["updated_at", "2025-06-09 12:16:10.690395"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 28], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.687344"], ["updated_at", "2025-06-09 12:16:10.687344"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.690064"], ["updated_at", "2025-06-09 12:16:10.690064"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (2.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.690807"], ["updated_at", "2025-06-09 12:16:10.690807"]]
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (3.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.693912"], ["updated_at", "2025-06-09 12:16:10.693912"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.698293"], ["updated_at", "2025-06-09 12:16:10.698293"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (3.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.694893"], ["updated_at", "2025-06-09 12:16:10.694893"]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.698797"], ["updated_at", "2025-06-09 12:16:10.698797"]]
  [1m[36mEpisode Load (1.7ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.703470"], ["updated_at", "2025-06-09 12:16:10.703470"]]
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (3.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.700976"], ["updated_at", "2025-06-09 12:16:10.700976"]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 8], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.707242"], ["updated_at", "2025-06-09 12:16:10.707242"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 19], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:10.707890"], ["updated_at", "2025-06-09 12:16:10.707890"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 8], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.711173"], ["updated_at", "2025-06-09 12:16:10.711173"]]
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Load (0.6ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (1.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 11], ["created_at", "2025-06-09 12:16:10.711838"], ["updated_at", "2025-06-09 12:16:10.711838"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 8], ["created_at", "2025-06-09 12:16:10.711906"], ["updated_at", "2025-06-09 12:16:10.711906"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.712591"], ["updated_at", "2025-06-09 12:16:10.712591"]]
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 11], ["LIMIT", 1]]
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:16:10.716785"], ["updated_at", "2025-06-09 12:16:10.716785"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.718899"], ["updated_at", "2025-06-09 12:16:10.718899"]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.719029"], ["updated_at", "2025-06-09 12:16:10.719029"]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 11], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:16:10.718511"], ["updated_at", "2025-06-09 12:16:10.718511"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.720050"], ["updated_at", "2025-06-09 12:16:10.720050"]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.721975"], ["updated_at", "2025-06-09 12:16:10.721975"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 18], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.722186"], ["updated_at", "2025-06-09 12:16:10.722186"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.723306"], ["updated_at", "2025-06-09 12:16:10.723306"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 12], ["created_at", "2025-06-09 12:16:10.723630"], ["updated_at", "2025-06-09 12:16:10.723630"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mReleaseDate Create (1.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 18], ["created_at", "2025-06-09 12:16:10.723845"], ["updated_at", "2025-06-09 12:16:10.723845"]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 9], ["created_at", "2025-06-09 12:16:10.725242"], ["updated_at", "2025-06-09 12:16:10.725242"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.726975"], ["updated_at", "2025-06-09 12:16:10.726975"]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 5], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.727132"], ["updated_at", "2025-06-09 12:16:10.727132"]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 18], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.727867"], ["updated_at", "2025-06-09 12:16:10.727867"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.728058"], ["updated_at", "2025-06-09 12:16:10.728058"]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.727734"], ["updated_at", "2025-06-09 12:16:10.727734"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 18], ["created_at", "2025-06-09 12:16:10.728750"], ["updated_at", "2025-06-09 12:16:10.728750"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 30], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.730624"], ["updated_at", "2025-06-09 12:16:10.730624"]]
-----------------------------------------------------------
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.730348"], ["updated_at", "2025-06-09 12:16:10.730348"]]
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.728506"], ["updated_at", "2025-06-09 12:16:10.728506"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.733057"], ["updated_at", "2025-06-09 12:16:10.733057"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.734524"], ["updated_at", "2025-06-09 12:16:10.734524"]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.734416"], ["updated_at", "2025-06-09 12:16:10.734416"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
-----------------------------------------------------------------
----------------------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 9], ["id", 8], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.735445"], ["updated_at", "2025-06-09 12:16:10.735445"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.739043"], ["updated_at", "2025-06-09 12:16:10.739043"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.735327"], ["updated_at", "2025-06-09 12:16:10.735327"]]
  [1m[36mReleaseDate Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 12], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 12], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.744654"], ["updated_at", "2025-06-09 12:16:10.744654"]]
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.743615"], ["updated_at", "2025-06-09 12:16:10.743615"]]
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (4.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 12:16:10.744317"], ["updated_at", "2025-06-09 12:16:10.744317"]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Count (2.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 10], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 20], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Create (1.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 12:16:10.756148"], ["updated_at", "2025-06-09 12:16:10.756148"]]
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.756700"], ["updated_at", "2025-06-09 12:16:10.756700"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 20], ["created_at", "2025-06-09 12:16:10.758058"], ["updated_at", "2025-06-09 12:16:10.758058"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_call_TvmazeIngestionService
--------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
Starting daily TVMaze ingestion job
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Starting daily TVMaze ingestion job
-----------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_accept_custom_parameters
-----------------------------------------------------------------
Starting daily TVMaze ingestion job
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:16:10.764417"], ["updated_at", "2025-06-09 12:16:10.764417"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Starting ingestion of upcoming episodes for 90 days
Starting ingestion of upcoming episodes for 90 days
Starting ingestion of upcoming episodes for 30 days
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.764630"], ["updated_at", "2025-06-09 12:16:10.764630"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 11], ["created_at", "2025-06-09 12:16:10.767247"], ["updated_at", "2025-06-09 12:16:10.767247"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 10], ["created_at", "2025-06-09 12:16:10.769444"], ["updated_at", "2025-06-09 12:16:10.769444"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 8], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-----------------------------------------------------------------
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.821122"], ["updated_at", "2025-06-09 12:16:10.821122"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.821292"], ["updated_at", "2025-06-09 12:16:10.821292"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.823313"], ["updated_at", "2025-06-09 12:16:10.823313"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.823153"], ["updated_at", "2025-06-09 12:16:10.823153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.826285"], ["updated_at", "2025-06-09 12:16:10.826285"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.826404"], ["updated_at", "2025-06-09 12:16:10.826404"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 12:16:10.828531"], ["updated_at", "2025-06-09 12:16:10.828531"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 12:16:10.835920"], ["updated_at", "2025-06-09 12:16:10.835920"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 12]]
  [1m[35mSQL (1.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 15]]
Completed 200 OK in 23ms (Views: 0.3ms | ActiveRecord: 3.8ms (2 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 23ms (Views: 0.3ms | ActiveRecord: 3.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.893541"], ["updated_at", "2025-06-09 12:16:10.893541"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.895096"], ["updated_at", "2025-06-09 12:16:10.895096"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.897577"], ["updated_at", "2025-06-09 12:16:10.897577"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.897806"], ["updated_at", "2025-06-09 12:16:10.897806"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.899194"], ["updated_at", "2025-06-09 12:16:10.899194"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 13], ["created_at", "2025-06-09 12:16:10.899613"], ["updated_at", "2025-06-09 12:16:10.899613"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 22], ["LIMIT", 1]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.902059"], ["updated_at", "2025-06-09 12:16:10.902059"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 12:16:10.904112"], ["updated_at", "2025-06-09 12:16:10.904112"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
  [1m[35mSQL (1.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 13]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.909707"], ["updated_at", "2025-06-09 12:16:10.909707"]]
  [1m[35mSQL (1.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 16]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 2.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.911265"], ["updated_at", "2025-06-09 12:16:10.911265"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.913759"], ["updated_at", "2025-06-09 12:16:10.913759"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 12:16:10.915839"], ["updated_at", "2025-06-09 12:16:10.915839"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.916366"], ["updated_at", "2025-06-09 12:16:10.916366"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.917757"], ["updated_at", "2025-06-09 12:16:10.917757"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.920531"], ["updated_at", "2025-06-09 12:16:10.920531"]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.920398"], ["updated_at", "2025-06-09 12:16:10.920398"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 17], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 17], ["created_at", "2025-06-09 12:16:10.922200"], ["updated_at", "2025-06-09 12:16:10.922200"]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.921973"], ["updated_at", "2025-06-09 12:16:10.921973"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Processing by Api::V1::TvShowsController#index as HTML
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.924284"], ["updated_at", "2025-06-09 12:16:10.924284"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.926233"], ["updated_at", "2025-06-09 12:16:10.926233"]]
  [1m[36mReleaseDate Create (0.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 12:16:10.926283"], ["updated_at", "2025-06-09 12:16:10.926283"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.927664"], ["updated_at", "2025-06-09 12:16:10.927664"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.930101"], ["updated_at", "2025-06-09 12:16:10.930101"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 18], ["LIMIT", 1]]
  [1m[35mSQL (1.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 15]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 18], ["created_at", "2025-06-09 12:16:10.931784"], ["updated_at", "2025-06-09 12:16:10.931784"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.7ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:16:10 +0100
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:10.936428"], ["updated_at", "2025-06-09 12:16:10.936428"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35mSQL (1.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 18]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.939274"], ["updated_at", "2025-06-09 12:16:10.939274"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:10.940574"], ["updated_at", "2025-06-09 12:16:10.940574"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 21], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 22], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.945309"], ["updated_at", "2025-06-09 12:16:10.945309"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.950264"], ["updated_at", "2025-06-09 12:16:10.950264"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.951809"], ["updated_at", "2025-06-09 12:16:10.951809"]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.952059"], ["updated_at", "2025-06-09 12:16:10.952059"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 23], ["id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.955627"], ["updated_at", "2025-06-09 12:16:10.955627"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.956386"], ["updated_at", "2025-06-09 12:16:10.956386"]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.957060"], ["updated_at", "2025-06-09 12:16:10.957060"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.957789"], ["updated_at", "2025-06-09 12:16:10.957789"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:10.958664"], ["updated_at", "2025-06-09 12:16:10.958664"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:10.959275"], ["updated_at", "2025-06-09 12:16:10.959275"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 25], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 26], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.962700"], ["updated_at", "2025-06-09 12:16:10.962700"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.962943"], ["updated_at", "2025-06-09 12:16:10.962943"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.964015"], ["updated_at", "2025-06-09 12:16:10.964015"]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.964215"], ["updated_at", "2025-06-09 12:16:10.964215"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.966700"], ["updated_at", "2025-06-09 12:16:10.966700"]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.967538"], ["updated_at", "2025-06-09 12:16:10.967538"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 21], ["id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.970363"], ["updated_at", "2025-06-09 12:16:10.970363"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 30], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:10.970398"], ["updated_at", "2025-06-09 12:16:10.970398"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:16:10.972363"], ["updated_at", "2025-06-09 12:16:10.972363"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-----------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.974000"], ["updated_at", "2025-06-09 12:16:10.974000"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.975192"], ["updated_at", "2025-06-09 12:16:10.975192"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 31], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.975420"], ["updated_at", "2025-06-09 12:16:10.975420"]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.978504"], ["updated_at", "2025-06-09 12:16:10.978504"]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:10.978534"], ["updated_at", "2025-06-09 12:16:10.978534"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:16:10.982873"], ["updated_at", "2025-06-09 12:16:10.982873"]]
  [1m[36mDistributor Create (0.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:16:10.983050"], ["updated_at", "2025-06-09 12:16:10.983050"]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 33], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:16:10.984521"], ["updated_at", "2025-06-09 12:16:10.984521"]]
  [1m[36mTvShow Create (0.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:16:10.984690"], ["updated_at", "2025-06-09 12:16:10.984690"]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 30], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:10.987147"], ["updated_at", "2025-06-09 12:16:10.987147"]]
  [1m[36mEpisode Create (0.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 23], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:10.987232"], ["updated_at", "2025-06-09 12:16:10.987232"]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 17], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 19], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 17], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 19], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 17], ["created_at", "2025-06-09 12:16:10.989000"], ["updated_at", "2025-06-09 12:16:10.989000"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 19], ["created_at", "2025-06-09 12:16:10.989141"], ["updated_at", "2025-06-09 12:16:10.989141"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mDistributor Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 29], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 23], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 19], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 19], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 19], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (3.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.8ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[35m (24.8ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (26.2ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "distributors", "tv_shows", "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[35m (3.9ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (27.1ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "release_dates" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "episodes" DISABLE TRIGGER ALL;ALTER TABLE "distributors" DISABLE TRIGGER ALL;ALTER TABLE "tv_shows" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (33.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[35m (34.5ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (29.5ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[35m (27.3ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (27.4ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (29.7ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (25.7ms)[0m  [1m[35mTRUNCATE TABLE "release_dates", "episodes", "distributors", "tv_shows"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "release_dates" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "episodes" ENABLE TRIGGER ALL;ALTER TABLE "distributors" ENABLE TRIGGER ALL;ALTER TABLE "tv_shows" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (5.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mDistributor Create (3.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.348158"], ["updated_at", "2025-06-09 12:16:33.348158"]]
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.347485"], ["updated_at", "2025-06-09 12:16:33.347485"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Count (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Create (3.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.354469"], ["updated_at", "2025-06-09 12:16:33.354469"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Load (0.6ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (4.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.371712"], ["updated_at", "2025-06-09 12:16:33.371712"]]
  [1m[36mDistributor Create (2.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.375597"], ["updated_at", "2025-06-09 12:16:33.375597"]]
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (6.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.372498"], ["updated_at", "2025-06-09 12:16:33.372498"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (4.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.376694"], ["updated_at", "2025-06-09 12:16:33.376694"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (4.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:33.391739"], ["updated_at", "2025-06-09 12:16:33.391739"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.391746"], ["updated_at", "2025-06-09 12:16:33.391746"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 18], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 19], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 30], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.392225"], ["updated_at", "2025-06-09 12:16:33.392225"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (2.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 17], ["id", 14], ["LIMIT", 1]]
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (2.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.407070"], ["updated_at", "2025-06-09 12:16:33.407070"]]
---------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.409492"], ["updated_at", "2025-06-09 12:16:33.409492"]]
  [1m[36mDistributor Load (1.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.411459"], ["updated_at", "2025-06-09 12:16:33.411459"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 30], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.411943"], ["updated_at", "2025-06-09 12:16:33.411943"]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.413823"], ["updated_at", "2025-06-09 12:16:33.413823"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 30], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.412032"], ["updated_at", "2025-06-09 12:16:33.412032"]]
  [1m[36mTvShow Create (9.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 17], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.408715"], ["updated_at", "2025-06-09 12:16:33.408715"]]
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.413678"], ["updated_at", "2025-06-09 12:16:33.413678"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mDistributor Create (6.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:33.414058"], ["updated_at", "2025-06-09 12:16:33.414058"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.424447"], ["updated_at", "2025-06-09 12:16:33.424447"]]
  [1m[36mEpisode Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 31], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.430653"], ["updated_at", "2025-06-09 12:16:33.430653"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.430748"], ["updated_at", "2025-06-09 12:16:33.430748"]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.432771"], ["updated_at", "2025-06-09 12:16:33.432771"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.433490"], ["updated_at", "2025-06-09 12:16:33.433490"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.433460"], ["updated_at", "2025-06-09 12:16:33.433460"]]
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mEpisode Create (3.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.434523"], ["updated_at", "2025-06-09 12:16:33.434523"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Create (4.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.436356"], ["updated_at", "2025-06-09 12:16:33.436356"]]
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 13], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.439256"], ["updated_at", "2025-06-09 12:16:33.439256"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.443774"], ["updated_at", "2025-06-09 12:16:33.443774"]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.444293"], ["updated_at", "2025-06-09 12:16:33.444293"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 33], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.446873"], ["updated_at", "2025-06-09 12:16:33.446873"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.447321"], ["updated_at", "2025-06-09 12:16:33.447321"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (6.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.442652"], ["updated_at", "2025-06-09 12:16:33.442652"]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.450616"], ["updated_at", "2025-06-09 12:16:33.450616"]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.450584"], ["updated_at", "2025-06-09 12:16:33.450584"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 27], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (2.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 10], ["created_at", "2025-06-09 12:16:33.449839"], ["updated_at", "2025-06-09 12:16:33.449839"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.452246"], ["updated_at", "2025-06-09 12:16:33.452246"]]
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.452565"], ["updated_at", "2025-06-09 12:16:33.452565"]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 10], ["id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 31], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.454260"], ["updated_at", "2025-06-09 12:16:33.454260"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 18], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.454520"], ["updated_at", "2025-06-09 12:16:33.454520"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (2.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.453369"], ["updated_at", "2025-06-09 12:16:33.453369"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 14], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.458726"], ["updated_at", "2025-06-09 12:16:33.458726"]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.458852"], ["updated_at", "2025-06-09 12:16:33.458852"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.457560"], ["updated_at", "2025-06-09 12:16:33.457560"]]
  [1m[36mTvShow Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.459082"], ["updated_at", "2025-06-09 12:16:33.459082"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.461026"], ["updated_at", "2025-06-09 12:16:33.461026"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.462947"], ["updated_at", "2025-06-09 12:16:33.462947"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 19], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 22], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 22], ["created_at", "2025-06-09 12:16:33.467213"], ["updated_at", "2025-06-09 12:16:33.467213"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mReleaseDate Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.469621"], ["updated_at", "2025-06-09 12:16:33.469621"]]
  [1m[36mReleaseDate Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.8ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 22], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.472210"], ["updated_at", "2025-06-09 12:16:33.472210"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 11], ["created_at", "2025-06-09 12:16:33.472832"], ["updated_at", "2025-06-09 12:16:33.472832"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 19], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 14], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:33.471945"], ["updated_at", "2025-06-09 12:16:33.471945"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 11], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 19], ["created_at", "2025-06-09 12:16:33.474835"], ["updated_at", "2025-06-09 12:16:33.474835"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.475305"], ["updated_at", "2025-06-09 12:16:33.475305"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 11], ["created_at", "2025-06-09 12:16:33.475223"], ["updated_at", "2025-06-09 12:16:33.475223"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 33], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.475940"], ["updated_at", "2025-06-09 12:16:33.475940"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.475137"], ["updated_at", "2025-06-09 12:16:33.475137"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 10], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 11], ["LIMIT", 1]]
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 19], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.478662"], ["updated_at", "2025-06-09 12:16:33.478662"]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.478466"], ["updated_at", "2025-06-09 12:16:33.478466"]]
  [1m[36mTvShow Exists? (2.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (3.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 21], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 22], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.481925"], ["updated_at", "2025-06-09 12:16:33.481925"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.482074"], ["updated_at", "2025-06-09 12:16:33.482074"]]
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 21], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:16:33.481662"], ["updated_at", "2025-06-09 12:16:33.481662"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 33], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.481802"], ["updated_at", "2025-06-09 12:16:33.481802"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 34], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.483086"], ["updated_at", "2025-06-09 12:16:33.483086"]]
  [1m[36mTvShow Create (2.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 34], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.480408"], ["updated_at", "2025-06-09 12:16:33.480408"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.483973"], ["updated_at", "2025-06-09 12:16:33.483973"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 13], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 14], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.485128"], ["updated_at", "2025-06-09 12:16:33.485128"]]
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.484400"], ["updated_at", "2025-06-09 12:16:33.484400"]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.485232"], ["updated_at", "2025-06-09 12:16:33.485232"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.485272"], ["updated_at", "2025-06-09 12:16:33.485272"]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 28], ["LIMIT", 1]]
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 20], ["created_at", "2025-06-09 12:16:33.486331"], ["updated_at", "2025-06-09 12:16:33.486331"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Count (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 28], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.488967"], ["updated_at", "2025-06-09 12:16:33.488967"]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.488298"], ["updated_at", "2025-06-09 12:16:33.488298"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.489186"], ["updated_at", "2025-06-09 12:16:33.489186"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 33], ["LIMIT", 1]]
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.490541"], ["updated_at", "2025-06-09 12:16:33.490541"]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.490396"], ["updated_at", "2025-06-09 12:16:33.490396"]]
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 33], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:16:33.490721"], ["updated_at", "2025-06-09 12:16:33.490721"]]
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.490688"], ["updated_at", "2025-06-09 12:16:33.490688"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 23], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.491956"], ["updated_at", "2025-06-09 12:16:33.491956"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 23], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.491579"], ["updated_at", "2025-06-09 12:16:33.491579"]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 25], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:33.491599"], ["updated_at", "2025-06-09 12:16:33.491599"]]
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 21], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 21], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.493200"], ["updated_at", "2025-06-09 12:16:33.493200"]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.492923"], ["updated_at", "2025-06-09 12:16:33.492923"]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 20], ["created_at", "2025-06-09 12:16:33.494123"], ["updated_at", "2025-06-09 12:16:33.494123"]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 23], ["created_at", "2025-06-09 12:16:33.493616"], ["updated_at", "2025-06-09 12:16:33.493616"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 21], ["created_at", "2025-06-09 12:16:33.494555"], ["updated_at", "2025-06-09 12:16:33.494555"]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.494536"], ["updated_at", "2025-06-09 12:16:33.494536"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 23], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 17], ["LIMIT", 1]]
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.499298"], ["updated_at", "2025-06-09 12:16:33.499298"]]
  [1m[36mEpisode Load (1.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 18], ["LIMIT", 1]]
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 20], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:33.499576"], ["updated_at", "2025-06-09 12:16:33.499576"]]
  [1m[36mEpisode Create (1.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 23], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.499035"], ["updated_at", "2025-06-09 12:16:33.499035"]]
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.501168"], ["updated_at", "2025-06-09 12:16:33.501168"]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.502206"], ["updated_at", "2025-06-09 12:16:33.502206"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.502136"], ["updated_at", "2025-06-09 12:16:33.502136"]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 15], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.503654"], ["updated_at", "2025-06-09 12:16:33.503654"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:16:33.503957"], ["updated_at", "2025-06-09 12:16:33.503957"]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 31], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 15], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:16:33.504455"], ["updated_at", "2025-06-09 12:16:33.504455"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 31], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:16:33.505345"], ["updated_at", "2025-06-09 12:16:33.505345"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 26], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:16:33.506388"], ["updated_at", "2025-06-09 12:16:33.506388"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 13], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 22], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 23], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 13], ["created_at", "2025-06-09 12:16:33.508560"], ["updated_at", "2025-06-09 12:16:33.508560"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 23], ["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 12], ["created_at", "2025-06-09 12:16:33.511447"], ["updated_at", "2025-06-09 12:16:33.511447"]]
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 8], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.563928"], ["updated_at", "2025-06-09 12:16:33.563928"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.564101"], ["updated_at", "2025-06-09 12:16:33.564101"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.564111"], ["updated_at", "2025-06-09 12:16:33.564111"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.564156"], ["updated_at", "2025-06-09 12:16:33.564156"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.564175"], ["updated_at", "2025-06-09 12:16:33.564175"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 27], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.566231"], ["updated_at", "2025-06-09 12:16:33.566231"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 22], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.566231"], ["updated_at", "2025-06-09 12:16:33.566231"]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.566238"], ["updated_at", "2025-06-09 12:16:33.566238"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 36], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.566302"], ["updated_at", "2025-06-09 12:16:33.566302"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 35], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.566502"], ["updated_at", "2025-06-09 12:16:33.566502"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 16], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 24], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 29], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 16], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.569639"], ["updated_at", "2025-06-09 12:16:33.569639"]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 32], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.569831"], ["updated_at", "2025-06-09 12:16:33.569831"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.569977"], ["updated_at", "2025-06-09 12:16:33.569977"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 24], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.569778"], ["updated_at", "2025-06-09 12:16:33.569778"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 32], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.570635"], ["updated_at", "2025-06-09 12:16:33.570635"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 24], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 14], ["created_at", "2025-06-09 12:16:33.571971"], ["updated_at", "2025-06-09 12:16:33.571971"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 24], ["created_at", "2025-06-09 12:16:33.572173"], ["updated_at", "2025-06-09 12:16:33.572173"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 21], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 12:16:33.579555"], ["updated_at", "2025-06-09 12:16:33.579555"]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 12:16:33.579742"], ["updated_at", "2025-06-09 12:16:33.579742"]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 21], ["created_at", "2025-06-09 12:16:33.579816"], ["updated_at", "2025-06-09 12:16:33.579816"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
Completed 400 Bad Request in 8ms (Views: 0.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.625088"], ["updated_at", "2025-06-09 12:16:33.625088"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 28], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.627219"], ["updated_at", "2025-06-09 12:16:33.627219"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 16]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (2.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 14]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 24]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 21]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.630371"], ["updated_at", "2025-06-09 12:16:33.630371"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 21ms (Views: 0.5ms | ActiveRecord: 4.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 16], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 16], ["created_at", "2025-06-09 12:16:33.632834"], ["updated_at", "2025-06-09 12:16:33.632834"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 4.0ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Completed 200 OK in 25ms (Views: 0.5ms | ActiveRecord: 4.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 25ms (Views: 0.3ms | ActiveRecord: 4.0ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Processing by Api::V1::TvShowsController#index as HTML
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.638542"], ["updated_at", "2025-06-09 12:16:33.638542"]]
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.639783"], ["updated_at", "2025-06-09 12:16:33.639783"]]
Starting ingestion of upcoming episodes for 90 days
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 30], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.640795"], ["updated_at", "2025-06-09 12:16:33.640795"]]
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 29], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.641679"], ["updated_at", "2025-06-09 12:16:33.641679"]]
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:16:33.642753"], ["updated_at", "2025-06-09 12:16:33.642753"]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:16:33.642836"], ["updated_at", "2025-06-09 12:16:33.642836"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 25], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 26], ["LIMIT", 1]]
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 26], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 25], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.644322"], ["updated_at", "2025-06-09 12:16:33.644322"]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 23], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:16:33.645194"], ["updated_at", "2025-06-09 12:16:33.645194"]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 26], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:16:33.645201"], ["updated_at", "2025-06-09 12:16:33.645201"]]
  [1m[36mTvShow Create (0.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 36], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:16:33.645339"], ["updated_at", "2025-06-09 12:16:33.645339"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 17], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 17], ["created_at", "2025-06-09 12:16:33.646680"], ["updated_at", "2025-06-09 12:16:33.646680"]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 17], ["LIMIT", 1]]
Starting daily TVMaze ingestion job
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 33], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 17], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 17], ["created_at", "2025-06-09 12:16:33.647685"], ["updated_at", "2025-06-09 12:16:33.647685"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 33], ["LIMIT", 1]]
Starting ingestion of upcoming episodes for 90 days
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 17], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:33.648411"], ["updated_at", "2025-06-09 12:16:33.648411"]]
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 33], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:16:33.648562"], ["updated_at", "2025-06-09 12:16:33.648562"]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Processing by Api::V1::TvShowsController#index as HTML
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 15], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 22], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 15], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 22], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 15], ["created_at", "2025-06-09 12:16:33.650846"], ["updated_at", "2025-06-09 12:16:33.650846"]]
  [1m[36mReleaseDate Create (0.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 22], ["created_at", "2025-06-09 12:16:33.650920"], ["updated_at", "2025-06-09 12:16:33.650920"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mDistributor Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 17]]
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTvShow Load (0.1ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:16:33 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 23], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (0.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 17], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_call_TvmazeIngestionService
--------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 17]]
Starting daily TVMaze ingestion job
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_accept_custom_parameters
-----------------------------------------------------------------
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 22], ["tv_show_id", 33], ["LIMIT", 1]]
Starting ingestion of upcoming episodes for 90 days
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 22], ["tv_show_id", 33], ["LIMIT", 1]]
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 30 days
  [1m[36mReleaseDate Load (0.1ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 22], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 4.2ms (2 queries, 0 cached) | GC: 0.0ms)
Ingestion completed: 1 processed, 0 errors
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDistributor Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.1ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (5.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 16.12s: 0 processed, 0 errors
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Ingestion completed: 0 processed, 0 errors
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.38s: 0 processed, 0 errors
Daily ingestion completed in 46.4s: 0 processed, 0 errors
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (8.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (7.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:35.880743"], ["updated_at", "2025-06-09 12:17:35.880743"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 39], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:35.924153"], ["updated_at", "2025-06-09 12:17:35.924153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 39], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 39], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 39], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:35.949539"], ["updated_at", "2025-06-09 12:17:35.949539"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (6.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 39], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 39], ["created_at", "2025-06-09 12:17:35.973703"], ["updated_at", "2025-06-09 12:17:35.973703"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:17:35 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (7.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (9.3ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 39]]
Completed 200 OK in 35ms (Views: 0.3ms | ActiveRecord: 16.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.049085"], ["updated_at", "2025-06-09 12:17:36.049085"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 40], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.051712"], ["updated_at", "2025-06-09 12:17:36.051712"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 40], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 40], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 40], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.054964"], ["updated_at", "2025-06-09 12:17:36.054964"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 40], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 40], ["created_at", "2025-06-09 12:17:36.057376"], ["updated_at", "2025-06-09 12:17:36.057376"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (2.9ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.8ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 40]]
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 6.8ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.8ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.086001"], ["updated_at", "2025-06-09 12:17:36.086001"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 41], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.088064"], ["updated_at", "2025-06-09 12:17:36.088064"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 41], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 41], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 41], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.091567"], ["updated_at", "2025-06-09 12:17:36.091567"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 41], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 41], ["created_at", "2025-06-09 12:17:36.095555"], ["updated_at", "2025-06-09 12:17:36.095555"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (4.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 41]]
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 11.9ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (1.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.119618"], ["updated_at", "2025-06-09 12:17:36.119618"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 42], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.121893"], ["updated_at", "2025-06-09 12:17:36.121893"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 42], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (3.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 42], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 42], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.128706"], ["updated_at", "2025-06-09 12:17:36.128706"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 42], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 42], ["created_at", "2025-06-09 12:17:36.131357"], ["updated_at", "2025-06-09 12:17:36.131357"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (4.7ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 42]]
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 6.5ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.151755"], ["updated_at", "2025-06-09 12:17:36.151755"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 43], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.153843"], ["updated_at", "2025-06-09 12:17:36.153843"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 43], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 43], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 43], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.157858"], ["updated_at", "2025-06-09 12:17:36.157858"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 43], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 43], ["created_at", "2025-06-09 12:17:36.160848"], ["updated_at", "2025-06-09 12:17:36.160848"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (15.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 43]]
Completed 200 OK in 20ms (Views: 0.1ms | ActiveRecord: 17.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.185906"], ["updated_at", "2025-06-09 12:17:36.185906"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 44], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.188065"], ["updated_at", "2025-06-09 12:17:36.188065"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 44], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 44], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 44], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.192642"], ["updated_at", "2025-06-09 12:17:36.192642"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 44], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 44], ["created_at", "2025-06-09 12:17:36.195274"], ["updated_at", "2025-06-09 12:17:36.195274"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (4.0ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 44]]
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 11.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.214742"], ["updated_at", "2025-06-09 12:17:36.214742"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 45], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.216973"], ["updated_at", "2025-06-09 12:17:36.216973"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 45], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 45], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 45], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.224611"], ["updated_at", "2025-06-09 12:17:36.224611"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 45], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 45], ["created_at", "2025-06-09 12:17:36.227654"], ["updated_at", "2025-06-09 12:17:36.227654"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.232686"], ["updated_at", "2025-06-09 12:17:36.232686"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 46], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.236326"], ["updated_at", "2025-06-09 12:17:36.236326"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 46], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 46], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 46], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:36.239989"], ["updated_at", "2025-06-09 12:17:36.239989"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 46], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 46], ["created_at", "2025-06-09 12:17:36.242230"], ["updated_at", "2025-06-09 12:17:36.242230"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:17:36 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.333004"], ["updated_at", "2025-06-09 12:17:40.333004"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.349334"], ["updated_at", "2025-06-09 12:17:40.349334"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (3.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.9ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:17:40.365666"], ["updated_at", "2025-06-09 12:17:40.365666"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.375794"], ["updated_at", "2025-06-09 12:17:40.375794"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:17:40.388387"], ["updated_at", "2025-06-09 12:17:40.388387"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 50], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 51], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.430098"], ["updated_at", "2025-06-09 12:17:40.430098"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 52], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.435343"], ["updated_at", "2025-06-09 12:17:40.435343"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 52], ["id", 47], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.447398"], ["updated_at", "2025-06-09 12:17:40.447398"]]
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 53], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.455534"], ["updated_at", "2025-06-09 12:17:40.455534"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 48], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 48], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 48], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.474259"], ["updated_at", "2025-06-09 12:17:40.474259"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 47], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 47], ["created_at", "2025-06-09 12:17:40.478524"], ["updated_at", "2025-06-09 12:17:40.478524"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.9ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 47], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.495491"], ["updated_at", "2025-06-09 12:17:40.495491"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 54], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.499469"], ["updated_at", "2025-06-09 12:17:40.499469"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 49], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 49], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 49], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.508017"], ["updated_at", "2025-06-09 12:17:40.508017"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 48], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 48], ["created_at", "2025-06-09 12:17:40.512259"], ["updated_at", "2025-06-09 12:17:40.512259"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 48], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 48], ["created_at", "2025-06-09 12:17:40.519495"], ["updated_at", "2025-06-09 12:17:40.519495"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 48], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 49], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.527793"], ["updated_at", "2025-06-09 12:17:40.527793"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 55], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.530911"], ["updated_at", "2025-06-09 12:17:40.530911"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 50], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 50], ["LIMIT", 1]]
  [1m[36mEpisode Create (3.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 50], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.539416"], ["updated_at", "2025-06-09 12:17:40.539416"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 49], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 49], ["created_at", "2025-06-09 12:17:40.548092"], ["updated_at", "2025-06-09 12:17:40.548092"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 50], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 50], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 50], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:17:40.564299"], ["updated_at", "2025-06-09 12:17:40.564299"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 50], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 50], ["created_at", "2025-06-09 12:17:40.572271"], ["updated_at", "2025-06-09 12:17:40.572271"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 50], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 51], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.580531"], ["updated_at", "2025-06-09 12:17:40.580531"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 56], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.583852"], ["updated_at", "2025-06-09 12:17:40.583852"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 51], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 51], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 51], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.590211"], ["updated_at", "2025-06-09 12:17:40.590211"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 51], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 51], ["created_at", "2025-06-09 12:17:40.594413"], ["updated_at", "2025-06-09 12:17:40.594413"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 51], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.601658"], ["updated_at", "2025-06-09 12:17:40.601658"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 57], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.604366"], ["updated_at", "2025-06-09 12:17:40.604366"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 52], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 52], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 52], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.608247"], ["updated_at", "2025-06-09 12:17:40.608247"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.6ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 52], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 52], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 52], ["created_at", "2025-06-09 12:17:40.613137"], ["updated_at", "2025-06-09 12:17:40.613137"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.632811"], ["updated_at", "2025-06-09 12:17:40.632811"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 58], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.635544"], ["updated_at", "2025-06-09 12:17:40.635544"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 53], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 53], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 53], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.639337"], ["updated_at", "2025-06-09 12:17:40.639337"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 53], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.645704"], ["updated_at", "2025-06-09 12:17:40.645704"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 59], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.649028"], ["updated_at", "2025-06-09 12:17:40.649028"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 54], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 54], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 54], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.652940"], ["updated_at", "2025-06-09 12:17:40.652940"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 54], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.659429"], ["updated_at", "2025-06-09 12:17:40.659429"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 60], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.662924"], ["updated_at", "2025-06-09 12:17:40.662924"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 55], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 55], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 55], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.666405"], ["updated_at", "2025-06-09 12:17:40.666405"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 55], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 55], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 55], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:17:40.670047"], ["updated_at", "2025-06-09 12:17:40.670047"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 56], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 56], ["created_at", "2025-06-09 12:17:40.672178"], ["updated_at", "2025-06-09 12:17:40.672178"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 55], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 55], ["created_at", "2025-06-09 12:17:40.674074"], ["updated_at", "2025-06-09 12:17:40.674074"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 54], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 55], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.681033"], ["updated_at", "2025-06-09 12:17:40.681033"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 61], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.683376"], ["updated_at", "2025-06-09 12:17:40.683376"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 56], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 56], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 56], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.686904"], ["updated_at", "2025-06-09 12:17:40.686904"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 57], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 57], ["created_at", "2025-06-09 12:17:40.689095"], ["updated_at", "2025-06-09 12:17:40.689095"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.693428"], ["updated_at", "2025-06-09 12:17:40.693428"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 62], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.696647"], ["updated_at", "2025-06-09 12:17:40.696647"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 57], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 57], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 57], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.700421"], ["updated_at", "2025-06-09 12:17:40.700421"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:17:40.707782"], ["updated_at", "2025-06-09 12:17:40.707782"]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 63], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:17:40.710806"], ["updated_at", "2025-06-09 12:17:40.710806"]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 58], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 58], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 58], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:17:40.715091"], ["updated_at", "2025-06-09 12:17:40.715091"]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 59], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 59], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 59], ["created_at", "2025-06-09 12:17:40.717698"], ["updated_at", "2025-06-09 12:17:40.717698"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 63], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 58], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 59], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:17:40.731991"], ["updated_at", "2025-06-09 12:17:40.731991"]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 64], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:17:40.734271"], ["updated_at", "2025-06-09 12:17:40.734271"]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 59], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 59], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 59], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:17:40.738608"], ["updated_at", "2025-06-09 12:17:40.738608"]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 60], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 60], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 60], ["created_at", "2025-06-09 12:17:40.740948"], ["updated_at", "2025-06-09 12:17:40.740948"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.5ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 60], ["tv_show_id", 59], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 60], ["tv_show_id", 59], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 60], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.777009"], ["updated_at", "2025-06-09 12:17:40.777009"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 65], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.780152"], ["updated_at", "2025-06-09 12:17:40.780152"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 60], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 60], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 60], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.785036"], ["updated_at", "2025-06-09 12:17:40.785036"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 60], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 60], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 60], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:17:40.789601"], ["updated_at", "2025-06-09 12:17:40.789601"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 61], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 62], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.794775"], ["updated_at", "2025-06-09 12:17:40.794775"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 66], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.796774"], ["updated_at", "2025-06-09 12:17:40.796774"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 61], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 61], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 61], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:17:40.801301"], ["updated_at", "2025-06-09 12:17:40.801301"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.804983"], ["updated_at", "2025-06-09 12:17:40.804983"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 67], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.807126"], ["updated_at", "2025-06-09 12:17:40.807126"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 62], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 62], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 62], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.810846"], ["updated_at", "2025-06-09 12:17:40.810846"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 62], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 62], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.816655"], ["updated_at", "2025-06-09 12:17:40.816655"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 68], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.819156"], ["updated_at", "2025-06-09 12:17:40.819156"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 63], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 63], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 63], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.823271"], ["updated_at", "2025-06-09 12:17:40.823271"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 63], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 63], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.828410"], ["updated_at", "2025-06-09 12:17:40.828410"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 69], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.830585"], ["updated_at", "2025-06-09 12:17:40.830585"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 64], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 64], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.836021"], ["updated_at", "2025-06-09 12:17:40.836021"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 70], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.837743"], ["updated_at", "2025-06-09 12:17:40.837743"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 65], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 65], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 65], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:17:40.842084"], ["updated_at", "2025-06-09 12:17:40.842084"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.846596"], ["updated_at", "2025-06-09 12:17:40.846596"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 71], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.848328"], ["updated_at", "2025-06-09 12:17:40.848328"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 66], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 66], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.852598"], ["updated_at", "2025-06-09 12:17:40.852598"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 72], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.854661"], ["updated_at", "2025-06-09 12:17:40.854661"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 67], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 67], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 67], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.857797"], ["updated_at", "2025-06-09 12:17:40.857797"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.861120"], ["updated_at", "2025-06-09 12:17:40.861120"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 73], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.863107"], ["updated_at", "2025-06-09 12:17:40.863107"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 68], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 68], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.868361"], ["updated_at", "2025-06-09 12:17:40.868361"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 74], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.870132"], ["updated_at", "2025-06-09 12:17:40.870132"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 69], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 69], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 69], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.874404"], ["updated_at", "2025-06-09 12:17:40.874404"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 68], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 68], ["created_at", "2025-06-09 12:17:40.876922"], ["updated_at", "2025-06-09 12:17:40.876922"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 68], ["id", 59], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.880064"], ["updated_at", "2025-06-09 12:17:40.880064"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 75], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:17:40.882254"], ["updated_at", "2025-06-09 12:17:40.882254"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 70], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 70], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_accept_custom_parameters
-----------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 30 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 16.23s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.6s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_call_TvmazeIngestionService
--------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.56s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (3.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (3.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.301057"], ["updated_at", "2025-06-09 12:19:30.301057"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 76], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:19:30.309640"], ["updated_at", "2025-06-09 12:19:30.309640"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.315987"], ["updated_at", "2025-06-09 12:19:30.315987"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 77], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.318279"], ["updated_at", "2025-06-09 12:19:30.318279"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.324713"], ["updated_at", "2025-06-09 12:19:30.324713"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 78], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.328873"], ["updated_at", "2025-06-09 12:19:30.328873"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 78], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:19:30.332799"], ["updated_at", "2025-06-09 12:19:30.332799"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 73], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 74], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.339954"], ["updated_at", "2025-06-09 12:19:30.339954"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.345297"], ["updated_at", "2025-06-09 12:19:30.345297"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 80], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.348198"], ["updated_at", "2025-06-09 12:19:30.348198"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 80], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:19:30.351424"], ["updated_at", "2025-06-09 12:19:30.351424"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 75], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 76], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.358209"], ["updated_at", "2025-06-09 12:19:30.358209"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 81], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.361626"], ["updated_at", "2025-06-09 12:19:30.361626"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 77], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (5.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 77], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 77], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.377374"], ["updated_at", "2025-06-09 12:19:30.377374"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 77], ["id", 69], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.383405"], ["updated_at", "2025-06-09 12:19:30.383405"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.387430"], ["updated_at", "2025-06-09 12:19:30.387430"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.392350"], ["updated_at", "2025-06-09 12:19:30.392350"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 84], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.396476"], ["updated_at", "2025-06-09 12:19:30.396476"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:19:30.400535"], ["updated_at", "2025-06-09 12:19:30.400535"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:19:30.403564"], ["updated_at", "2025-06-09 12:19:30.403564"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_call_TvmazeIngestionService
--------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.59s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_accept_custom_parameters
-----------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 30 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 16.24s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.76s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (16.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (61.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:40.837561"], ["updated_at", "2025-06-09 12:21:40.837561"]]
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (4.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 86], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:40.971746"], ["updated_at", "2025-06-09 12:21:40.971746"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 80], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 80], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 80], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:40.995308"], ["updated_at", "2025-06-09 12:21:40.995308"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.001883"], ["updated_at", "2025-06-09 12:21:41.001883"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 87], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.004615"], ["updated_at", "2025-06-09 12:21:41.004615"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 81], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 81], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 81], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.009088"], ["updated_at", "2025-06-09 12:21:41.009088"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (2.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 71], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 71], ["created_at", "2025-06-09 12:21:41.023080"], ["updated_at", "2025-06-09 12:21:41.023080"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 71], ["id", 60], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.033141"], ["updated_at", "2025-06-09 12:21:41.033141"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 88], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.034832"], ["updated_at", "2025-06-09 12:21:41.034832"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 82], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 82], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 82], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.038393"], ["updated_at", "2025-06-09 12:21:41.038393"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 82], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 82], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 82], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:21:41.041555"], ["updated_at", "2025-06-09 12:21:41.041555"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 72], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 73], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.045783"], ["updated_at", "2025-06-09 12:21:41.045783"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 89], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.049311"], ["updated_at", "2025-06-09 12:21:41.049311"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 83], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 83], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.053812"], ["updated_at", "2025-06-09 12:21:41.053812"]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 90], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.058348"], ["updated_at", "2025-06-09 12:21:41.058348"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (4.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 84], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 84], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 84], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:21:41.068300"], ["updated_at", "2025-06-09 12:21:41.068300"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.072210"], ["updated_at", "2025-06-09 12:21:41.072210"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 91], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.074891"], ["updated_at", "2025-06-09 12:21:41.074891"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 85], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 85], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 85], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:21:41.080066"], ["updated_at", "2025-06-09 12:21:41.080066"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.083379"], ["updated_at", "2025-06-09 12:21:41.083379"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 92], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.085811"], ["updated_at", "2025-06-09 12:21:41.085811"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 86], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 86], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 86], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.089562"], ["updated_at", "2025-06-09 12:21:41.089562"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 86], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 86], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.097815"], ["updated_at", "2025-06-09 12:21:41.097815"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 93], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.099868"], ["updated_at", "2025-06-09 12:21:41.099868"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 87], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 87], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 87], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.103186"], ["updated_at", "2025-06-09 12:21:41.103186"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 87], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 87], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.109462"], ["updated_at", "2025-06-09 12:21:41.109462"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 94], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.113284"], ["updated_at", "2025-06-09 12:21:41.113284"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 88], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 88], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.118878"], ["updated_at", "2025-06-09 12:21:41.118878"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 95], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.120957"], ["updated_at", "2025-06-09 12:21:41.120957"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 89], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 89], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.126065"], ["updated_at", "2025-06-09 12:21:41.126065"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 96], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.128572"], ["updated_at", "2025-06-09 12:21:41.128572"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (4.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 90], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 90], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.6ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:21:41.140586"], ["updated_at", "2025-06-09 12:21:41.140586"]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 97], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:21:41.143537"], ["updated_at", "2025-06-09 12:21:41.143537"]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 91], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 91], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 91], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:21:41.148901"], ["updated_at", "2025-06-09 12:21:41.148901"]]
  [1m[36mReleaseDate Load (0.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 78], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 78], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 78], ["created_at", "2025-06-09 12:21:41.152429"], ["updated_at", "2025-06-09 12:21:41.152429"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 78], ["tv_show_id", 91], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 78], ["tv_show_id", 91], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 78], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.5ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:21:41.206815"], ["updated_at", "2025-06-09 12:21:41.206815"]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 98], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:21:41.208979"], ["updated_at", "2025-06-09 12:21:41.208979"]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 92], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 92], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 92], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:21:41.212383"], ["updated_at", "2025-06-09 12:21:41.212383"]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 79], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 79], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 79], ["created_at", "2025-06-09 12:21:41.215576"], ["updated_at", "2025-06-09 12:21:41.215576"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 98], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 92], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 79], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.230218"], ["updated_at", "2025-06-09 12:21:41.230218"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.234140"], ["updated_at", "2025-06-09 12:21:41.234140"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 100], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.236062"], ["updated_at", "2025-06-09 12:21:41.236062"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 100], ["id", 93], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:21:41.245222"], ["updated_at", "2025-06-09 12:21:41.245222"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.250729"], ["updated_at", "2025-06-09 12:21:41.250729"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.255075"], ["updated_at", "2025-06-09 12:21:41.255075"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:21:41.258252"], ["updated_at", "2025-06-09 12:21:41.258252"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 103], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 104], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.269593"], ["updated_at", "2025-06-09 12:21:41.269593"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.274081"], ["updated_at", "2025-06-09 12:21:41.274081"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 106], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.276077"], ["updated_at", "2025-06-09 12:21:41.276077"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.282298"], ["updated_at", "2025-06-09 12:21:41.282298"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 107], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.283897"], ["updated_at", "2025-06-09 12:21:41.283897"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.287706"], ["updated_at", "2025-06-09 12:21:41.287706"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (1.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:21:41.291418"], ["updated_at", "2025-06-09 12:21:41.291418"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.296819"], ["updated_at", "2025-06-09 12:21:41.296819"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 109], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.303364"], ["updated_at", "2025-06-09 12:21:41.303364"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 109], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:21:41.307492"], ["updated_at", "2025-06-09 12:21:41.307492"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 97], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 98], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.315061"], ["updated_at", "2025-06-09 12:21:41.315061"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Load (0.2ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 110], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:21:41.319044"], ["updated_at", "2025-06-09 12:21:41.319044"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.323410"], ["updated_at", "2025-06-09 12:21:41.323410"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.327312"], ["updated_at", "2025-06-09 12:21:41.327312"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 112], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.330054"], ["updated_at", "2025-06-09 12:21:41.330054"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 112], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:21:41.333334"], ["updated_at", "2025-06-09 12:21:41.333334"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 100], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 101], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.338775"], ["updated_at", "2025-06-09 12:21:41.338775"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 113], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.342333"], ["updated_at", "2025-06-09 12:21:41.342333"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 102], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 102], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 102], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.354614"], ["updated_at", "2025-06-09 12:21:41.354614"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 102], ["id", 80], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.359232"], ["updated_at", "2025-06-09 12:21:41.359232"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.405711"], ["updated_at", "2025-06-09 12:21:41.405711"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 115], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.410942"], ["updated_at", "2025-06-09 12:21:41.410942"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (8.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (9.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 103], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 103], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 103], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.424941"], ["updated_at", "2025-06-09 12:21:41.424941"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 81], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 81], ["created_at", "2025-06-09 12:21:41.428954"], ["updated_at", "2025-06-09 12:21:41.428954"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (3.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 81]]
Completed 200 OK in 24ms (Views: 0.3ms | ActiveRecord: 9.8ms (2 queries, 0 cached) | GC: 0.3ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.502490"], ["updated_at", "2025-06-09 12:21:41.502490"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 116], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.505904"], ["updated_at", "2025-06-09 12:21:41.505904"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 104], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 104], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 104], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.509584"], ["updated_at", "2025-06-09 12:21:41.509584"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 82], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 82], ["created_at", "2025-06-09 12:21:41.511831"], ["updated_at", "2025-06-09 12:21:41.511831"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.516130"], ["updated_at", "2025-06-09 12:21:41.516130"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 117], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.518026"], ["updated_at", "2025-06-09 12:21:41.518026"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 105], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 105], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 105], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.520886"], ["updated_at", "2025-06-09 12:21:41.520886"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 83], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 83], ["created_at", "2025-06-09 12:21:41.523543"], ["updated_at", "2025-06-09 12:21:41.523543"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.528239"], ["updated_at", "2025-06-09 12:21:41.528239"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 118], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.530407"], ["updated_at", "2025-06-09 12:21:41.530407"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 106], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 106], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 106], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.534180"], ["updated_at", "2025-06-09 12:21:41.534180"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 84], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 84], ["created_at", "2025-06-09 12:21:41.536544"], ["updated_at", "2025-06-09 12:21:41.536544"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (1.8ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (5.5ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 84]]
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 7.3ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (2.1ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 2.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.557888"], ["updated_at", "2025-06-09 12:21:41.557888"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 119], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.560162"], ["updated_at", "2025-06-09 12:21:41.560162"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 107], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 107], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 107], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.566740"], ["updated_at", "2025-06-09 12:21:41.566740"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 85], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 85], ["created_at", "2025-06-09 12:21:41.568645"], ["updated_at", "2025-06-09 12:21:41.568645"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (2.5ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.2ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 85]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 8.6ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.587494"], ["updated_at", "2025-06-09 12:21:41.587494"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 120], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.590621"], ["updated_at", "2025-06-09 12:21:41.590621"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 108], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 108], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 108], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.595268"], ["updated_at", "2025-06-09 12:21:41.595268"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 86], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.8ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 86], ["created_at", "2025-06-09 12:21:41.598991"], ["updated_at", "2025-06-09 12:21:41.598991"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (3.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (7.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 86]]
Completed 200 OK in 16ms (Views: 0.1ms | ActiveRecord: 11.2ms (2 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.624798"], ["updated_at", "2025-06-09 12:21:41.624798"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 121], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.627125"], ["updated_at", "2025-06-09 12:21:41.627125"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 109], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 109], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 109], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.636307"], ["updated_at", "2025-06-09 12:21:41.636307"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 87], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 87], ["created_at", "2025-06-09 12:21:41.640039"], ["updated_at", "2025-06-09 12:21:41.640039"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (2.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (4.5ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 87]]
Completed 200 OK in 12ms (Views: 0.4ms | ActiveRecord: 6.7ms (2 queries, 0 cached) | GC: 2.6ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.660487"], ["updated_at", "2025-06-09 12:21:41.660487"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 122], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.664766"], ["updated_at", "2025-06-09 12:21:41.664766"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 110], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 110], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 110], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.670425"], ["updated_at", "2025-06-09 12:21:41.670425"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 88], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.2ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 88], ["created_at", "2025-06-09 12:21:41.674289"], ["updated_at", "2025-06-09 12:21:41.674289"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:21:41 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (5.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (3.0ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 88]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 8.3ms (2 queries, 0 cached) | GC: 1.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.694785"], ["updated_at", "2025-06-09 12:21:41.694785"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 123], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.698469"], ["updated_at", "2025-06-09 12:21:41.698469"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 111], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 111], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 111], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.705026"], ["updated_at", "2025-06-09 12:21:41.705026"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 89], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.712083"], ["updated_at", "2025-06-09 12:21:41.712083"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 124], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.716230"], ["updated_at", "2025-06-09 12:21:41.716230"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 112], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 112], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 112], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.723168"], ["updated_at", "2025-06-09 12:21:41.723168"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 90], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 90], ["created_at", "2025-06-09 12:21:41.726664"], ["updated_at", "2025-06-09 12:21:41.726664"]]
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.733082"], ["updated_at", "2025-06-09 12:21:41.733082"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 125], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.735590"], ["updated_at", "2025-06-09 12:21:41.735590"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 113], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 113], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 113], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.741597"], ["updated_at", "2025-06-09 12:21:41.741597"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (6.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 91], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 91], ["created_at", "2025-06-09 12:21:41.750911"], ["updated_at", "2025-06-09 12:21:41.750911"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 91], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 91], ["created_at", "2025-06-09 12:21:41.754021"], ["updated_at", "2025-06-09 12:21:41.754021"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 72], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 73], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.761755"], ["updated_at", "2025-06-09 12:21:41.761755"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 126], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.766037"], ["updated_at", "2025-06-09 12:21:41.766037"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 114], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 114], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 114], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.770422"], ["updated_at", "2025-06-09 12:21:41.770422"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.776992"], ["updated_at", "2025-06-09 12:21:41.776992"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 127], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.780834"], ["updated_at", "2025-06-09 12:21:41.780834"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 115], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 115], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 115], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.785730"], ["updated_at", "2025-06-09 12:21:41.785730"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 93], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 93], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 93], ["created_at", "2025-06-09 12:21:41.791582"], ["updated_at", "2025-06-09 12:21:41.791582"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (2.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.802181"], ["updated_at", "2025-06-09 12:21:41.802181"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 128], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.804977"], ["updated_at", "2025-06-09 12:21:41.804977"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 116], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 116], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 116], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.813271"], ["updated_at", "2025-06-09 12:21:41.813271"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 94], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.9ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 94], ["created_at", "2025-06-09 12:21:41.815631"], ["updated_at", "2025-06-09 12:21:41.815631"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.4ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 94], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (4.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.825191"], ["updated_at", "2025-06-09 12:21:41.825191"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 129], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.827108"], ["updated_at", "2025-06-09 12:21:41.827108"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 117], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 117], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 117], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.831399"], ["updated_at", "2025-06-09 12:21:41.831399"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 117], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 117], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 117], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:21:41.835175"], ["updated_at", "2025-06-09 12:21:41.835175"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 96], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 96], ["created_at", "2025-06-09 12:21:41.837194"], ["updated_at", "2025-06-09 12:21:41.837194"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 95], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 95], ["created_at", "2025-06-09 12:21:41.839230"], ["updated_at", "2025-06-09 12:21:41.839230"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 76], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 77], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.844580"], ["updated_at", "2025-06-09 12:21:41.844580"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 130], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.846563"], ["updated_at", "2025-06-09 12:21:41.846563"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 118], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 118], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 118], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.849585"], ["updated_at", "2025-06-09 12:21:41.849585"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 97], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 97], ["created_at", "2025-06-09 12:21:41.851463"], ["updated_at", "2025-06-09 12:21:41.851463"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 118], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 118], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 118], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:21:41.854679"], ["updated_at", "2025-06-09 12:21:41.854679"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 98], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 98], ["created_at", "2025-06-09 12:21:41.857127"], ["updated_at", "2025-06-09 12:21:41.857127"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 78], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 79], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.860793"], ["updated_at", "2025-06-09 12:21:41.860793"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 131], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.864420"], ["updated_at", "2025-06-09 12:21:41.864420"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 119], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 119], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 119], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.867566"], ["updated_at", "2025-06-09 12:21:41.867566"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 99], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.872006"], ["updated_at", "2025-06-09 12:21:41.872006"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 132], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.873846"], ["updated_at", "2025-06-09 12:21:41.873846"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 120], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 120], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.3ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 120], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:21:41.877207"], ["updated_at", "2025-06-09 12:21:41.877207"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 100], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 100], ["created_at", "2025-06-09 12:21:41.881074"], ["updated_at", "2025-06-09 12:21:41.881074"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 100], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_returns_parsed_JSON_for_valid_response
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_handles_404_gracefully
------------------------------------------------------------
Not found: https://api.tvmaze.com/schedule?country=US
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_RateLimitError_on_429
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TvmazeClientTest: test_fetch_schedule_raises_ApiError_on_other_HTTP_errors
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvmazeClientTest: test_fetch_upcoming_episodes_fetches_range_of_dates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
EpisodeTest: test_should_be_valid_with_valid_attributes
-------------------------------------------------------
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (9.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.458840"], ["updated_at", "2025-06-09 12:22:03.458840"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (6.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 133], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.505752"], ["updated_at", "2025-06-09 12:22:03.505752"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 121], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 121], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
EpisodeTest: test_by_season_scope_should_filter_by_season
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.535917"], ["updated_at", "2025-06-09 12:22:03.535917"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 134], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.541448"], ["updated_at", "2025-06-09 12:22:03.541448"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 122], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 122], ["LIMIT", 1]]
  [1m[36mEpisode Create (6.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 122], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.546893"], ["updated_at", "2025-06-09 12:22:03.546893"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 122], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 122], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Season 2 Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 122], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:22:03.558633"], ["updated_at", "2025-06-09 12:22:03.558633"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 101], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["season", 1], ["id", 102], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_create_new_episode
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.2ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.562969"], ["updated_at", "2025-06-09 12:22:03.562969"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 135], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.565397"], ["updated_at", "2025-06-09 12:22:03.565397"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (2.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "New Episode"], ["season", 2], ["episode_number", 5], ["episode_type", "finale"], ["runtime", 90], ["rating", "9.0"], ["image_medium", "https://example.com/episode_medium.jpg"], ["image_original", "https://example.com/episode_original.jpg"], ["summary", "<p>Episode summary</p>"], ["tv_show_id", 123], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:22:03.573183"], ["updated_at", "2025-06-09 12:22:03.573183"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
EpisodeTest: test_should_require_unique_tvmaze_id
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.577408"], ["updated_at", "2025-06-09 12:22:03.577408"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 136], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.579410"], ["updated_at", "2025-06-09 12:22:03.579410"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.1ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 124], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.583427"], ["updated_at", "2025-06-09 12:22:03.583427"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_belong_to_tv_show
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.594856"], ["updated_at", "2025-06-09 12:22:03.594856"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 137], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.596969"], ["updated_at", "2025-06-09 12:22:03.596969"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 125], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 125], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 125], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.602278"], ["updated_at", "2025-06-09 12:22:03.602278"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
EpisodeTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.607261"], ["updated_at", "2025-06-09 12:22:03.607261"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 138], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.609203"], ["updated_at", "2025-06-09 12:22:03.609203"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (2.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 126], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (6.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 126], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Minimal Episode"], ["season", 3], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 126], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:22:03.621804"], ["updated_at", "2025-06-09 12:22:03.621804"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
EpisodeTest: test_should_have_many_release_dates
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.625601"], ["updated_at", "2025-06-09 12:22:03.625601"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.9ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 139], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.627353"], ["updated_at", "2025-06-09 12:22:03.627353"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 127], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 127], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 127], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.631996"], ["updated_at", "2025-06-09 12:22:03.631996"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.2ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 107], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 107], ["created_at", "2025-06-09 12:22:03.646335"], ["updated_at", "2025-06-09 12:22:03.646335"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["episode_id", 107], ["id", 81], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
EpisodeTest: test_should_require_tvmaze_id
------------------------------------------
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (4.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.660423"], ["updated_at", "2025-06-09 12:22:03.660423"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 140], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.662404"], ["updated_at", "2025-06-09 12:22:03.662404"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 128], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 128], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
EpisodeTest: test_should_require_name
-------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.672269"], ["updated_at", "2025-06-09 12:22:03.672269"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 141], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.674719"], ["updated_at", "2025-06-09 12:22:03.674719"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 129], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 129], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
EpisodeTest: test_should_require_season_and_episode_number
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.681658"], ["updated_at", "2025-06-09 12:22:03.681658"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 142], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.684407"], ["updated_at", "2025-06-09 12:22:03.684407"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 130], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" IS NULL AND "episodes"."tv_show_id" = $1 LIMIT $2[0m  [["tv_show_id", 130], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
EpisodeTest: test_should_require_unique_season_and_episode_number_per_show
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.693785"], ["updated_at", "2025-06-09 12:22:03.693785"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 143], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.697160"], ["updated_at", "2025-06-09 12:22:03.697160"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 131], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 131], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 131], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.702610"], ["updated_at", "2025-06-09 12:22:03.702610"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 131], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 131], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_handle_nil_values_gracefully
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.713458"], ["updated_at", "2025-06-09 12:22:03.713458"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 124], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Minimal Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", nil], ["tvmaze_id", 124], ["created_at", "2025-06-09 12:22:03.717624"], ["updated_at", "2025-06-09 12:22:03.717624"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TvShowTest: test_by_status_scope_should_filter_by_status
--------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.721847"], ["updated_at", "2025-06-09 12:22:03.721847"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 145], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.724739"], ["updated_at", "2025-06-09 12:22:03.724739"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Ended Show"], ["show_type", nil], ["language", nil], ["status", "Ended"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 145], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:22:03.727553"], ["updated_at", "2025-06-09 12:22:03.727553"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 133], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."status" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["status", "Running"], ["id", 134], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------
TvShowTest: test_should_be_valid_with_valid_attributes
------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.735099"], ["updated_at", "2025-06-09 12:22:03.735099"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
TvShowTest: test_by_rating_scope_should_filter_by_minimum_rating
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.741660"], ["updated_at", "2025-06-09 12:22:03.741660"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 147], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.743574"], ["updated_at", "2025-06-09 12:22:03.743574"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Low Rated Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "5.0"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 147], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:22:03.746001"], ["updated_at", "2025-06-09 12:22:03.746001"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 135], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE (rating >= $1) AND "tv_shows"."id" = $2 LIMIT $3[0m  [[nil, 8.0], ["id", 136], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
TvShowTest: test_find_or_create_by_tvmaze_data_should_create_new_show
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.752605"], ["updated_at", "2025-06-09 12:22:03.752605"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "New Show"], ["show_type", "Documentary"], ["language", "Spanish"], ["status", "In Development"], ["runtime", 30], ["premiered", "2025-01-01"], ["ended", "2025-12-31"], ["official_site", "https://example.com"], ["rating", "7.5"], ["genres", "Drama, Comedy"], ["schedule_time", "20:00"], ["schedule_days", "Monday, Tuesday"], ["image_medium", "https://example.com/medium.jpg"], ["image_original", "https://example.com/original.jpg"], ["summary", "<p>Test summary</p>"], ["network_id", 148], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:22:03.758153"], ["updated_at", "2025-06-09 12:22:03.758153"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_belong_to_network
-----------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.763101"], ["updated_at", "2025-06-09 12:22:03.763101"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 149], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.766665"], ["updated_at", "2025-06-09 12:22:03.766665"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
TvShowTest: test_should_have_many_episodes
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.769595"], ["updated_at", "2025-06-09 12:22:03.769595"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (3.0ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 150], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.771930"], ["updated_at", "2025-06-09 12:22:03.771930"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 139], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 139], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.9ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 139], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.783466"], ["updated_at", "2025-06-09 12:22:03.783466"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tv_show_id" = $1 AND "episodes"."id" = $2 LIMIT $3[0m  [["tv_show_id", 139], ["id", 109], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
TvShowTest: test_should_require_tvmaze_id
-----------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.788547"], ["updated_at", "2025-06-09 12:22:03.788547"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
TvShowTest: test_should_require_name
------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (5.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.793767"], ["updated_at", "2025-06-09 12:22:03.793767"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
TvShowTest: test_should_require_unique_tvmaze_id
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.9ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.801899"], ["updated_at", "2025-06-09 12:22:03.801899"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 153], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.804803"], ["updated_at", "2025-06-09 12:22:03.804803"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_return_nil_for_nil_data
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_create_new_distributor
---------------------------------------------------------------------------------
  [1m[36mDistributor Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.1ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "New Network"], ["country", "United Kingdom"], ["official_site", "https://example.com"], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:22:03.812497"], ["updated_at", "2025-06-09 12:22:03.812497"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
DistributorTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DistributorTest: test_by_country_scope_should_filter_by_country
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.818618"], ["updated_at", "2025-06-09 12:22:03.818618"]]
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 2], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Canadian Network"], ["country", "Canada"], ["official_site", nil], ["tvmaze_id", 2], ["created_at", "2025-06-09 12:22:03.824890"], ["updated_at", "2025-06-09 12:22:03.824890"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 155], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."country" = $1 AND "distributors"."id" = $2 LIMIT $3[0m  [["country", "United States"], ["id", 156], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
DistributorTest: test_find_or_create_by_tvmaze_data_should_find_existing_distributor
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (4.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.832127"], ["updated_at", "2025-06-09 12:22:03.832127"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mCACHE Distributor Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
DistributorTest: test_should_have_many_tv_shows
-----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.840695"], ["updated_at", "2025-06-09 12:22:03.840695"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 158], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.842582"], ["updated_at", "2025-06-09 12:22:03.842582"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."network_id" = $1 AND "tv_shows"."id" = $2 LIMIT $3[0m  [["network_id", 158], ["id", 141], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
DistributorTest: test_should_require_name
-----------------------------------------
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------
DistributorTest: test_should_require_unique_tvmaze_id
-----------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.850498"], ["updated_at", "2025-06-09 12:22:03.850498"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
DistributorTest: test_should_require_tvmaze_id
----------------------------------------------
  [1m[36mDistributor Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_handles_invalid_date_format
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.890484"], ["updated_at", "2025-06-09 12:22:03.890484"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 160], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.893131"], ["updated_at", "2025-06-09 12:22:03.893131"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 142], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 142], ["LIMIT", 1]]
  [1m[36mEpisode Create (3.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 142], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.897190"], ["updated_at", "2025-06-09 12:22:03.897190"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 110], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 110], ["created_at", "2025-06-09 12:22:03.901739"], ["updated_at", "2025-06-09 12:22:03.901739"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=invalid-date&date_to=2025-06-09" for 127.0.0.1 at 2025-06-09 13:22:03 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "invalid-date", "date_to" => "2025-06-09"}
Completed 400 Bad Request in 7ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_returns_episodes_within_date_range
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.944406"], ["updated_at", "2025-06-09 12:22:03.944406"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 161], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.946394"], ["updated_at", "2025-06-09 12:22:03.946394"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 143], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 143], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 143], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.950925"], ["updated_at", "2025-06-09 12:22:03.950925"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 111], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 111], ["created_at", "2025-06-09 12:22:03.953490"], ["updated_at", "2025-06-09 12:22:03.953490"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:22:03 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (8.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 111]]
Completed 200 OK in 22ms (Views: 0.2ms | ActiveRecord: 14.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_sets_appropriate_cache_headers
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.981094"], ["updated_at", "2025-06-09 12:22:03.981094"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 162], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.983263"], ["updated_at", "2025-06-09 12:22:03.983263"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 144], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 144], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 144], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:03.987886"], ["updated_at", "2025-06-09 12:22:03.987886"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 112], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 112], ["created_at", "2025-06-09 12:22:03.990062"], ["updated_at", "2025-06-09 12:22:03.990062"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16" for 127.0.0.1 at 2025-06-09 13:22:03 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16"}
  [1m[35mSQL (3.3ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (7.1ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 112]]
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 10.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_country
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.008247"], ["updated_at", "2025-06-09 12:22:04.008247"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 163], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.010364"], ["updated_at", "2025-06-09 12:22:04.010364"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 145], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 145], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 145], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.030877"], ["updated_at", "2025-06-09 12:22:04.030877"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 113], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.1ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 113], ["created_at", "2025-06-09 12:22:04.034597"], ["updated_at", "2025-06-09 12:22:04.034597"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&country=United+States" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "country" => "United States"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (10.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."country" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["country", "United States"], ["id", 113]]
Completed 200 OK in 16ms (Views: 0.1ms | ActiveRecord: 12.3ms (2 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_rating
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.056325"], ["updated_at", "2025-06-09 12:22:04.056325"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 164], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.058671"], ["updated_at", "2025-06-09 12:22:04.058671"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 146], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 146], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 146], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.065927"], ["updated_at", "2025-06-09 12:22:04.065927"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 114], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 114], ["created_at", "2025-06-09 12:22:04.067972"], ["updated_at", "2025-06-09 12:22:04.067972"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=8.0" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "8.0"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (9.9ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 8.0], ["id", 114]]
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 11.3ms (2 queries, 0 cached) | GC: 0.5ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&rating=9.0" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "rating" => "9.0"}
  [1m[35mSQL (1.4ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND (tv_shows.rating >= $3) ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], [nil, 9.0], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_requires_date_from_and_date_to_parameters
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.097029"], ["updated_at", "2025-06-09 12:22:04.097029"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 165], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.099308"], ["updated_at", "2025-06-09 12:22:04.099308"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 147], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 147], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 147], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.103080"], ["updated_at", "2025-06-09 12:22:04.103080"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 115], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.7ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 115], ["created_at", "2025-06-09 12:22:04.108666"], ["updated_at", "2025-06-09 12:22:04.108666"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
Completed 400 Bad Request in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_filters_by_distributor
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.114510"], ["updated_at", "2025-06-09 12:22:04.114510"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 166], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.116128"], ["updated_at", "2025-06-09 12:22:04.116128"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 148], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 148], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 148], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.119818"], ["updated_at", "2025-06-09 12:22:04.119818"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 116], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 116], ["created_at", "2025-06-09 12:22:04.121717"], ["updated_at", "2025-06-09 12:22:04.121717"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Test+Network" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Test Network"}
  [1m[35mSQL (2.7ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["LIMIT", 25], ["OFFSET", 0]]
  [1m[35mSQL (6.5ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 AND "episodes"."id" = $4 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Test Network"], ["id", 116]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 9.2ms (2 queries, 0 cached) | GC: 0.2ms)
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&distributor=Non-existent+Network" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "distributor" => "Non-existent Network"}
  [1m[35mSQL (2.6ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "distributors"."name" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $4 OFFSET $5[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["name", "Non-existent Network"], ["LIMIT", 25], ["OFFSET", 0]]
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 2.6ms (1 query, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::V1::TvShowsControllerTest: test_index_includes_pagination_metadata
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.143424"], ["updated_at", "2025-06-09 12:22:04.143424"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (2.5ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.3ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", "8.5"], ["genres", "Drama, Comedy"], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 167], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.148507"], ["updated_at", "2025-06-09 12:22:04.148507"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 149], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 149], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", "8.0"], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 149], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:22:04.152688"], ["updated_at", "2025-06-09 12:22:04.152688"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 117], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 117], ["created_at", "2025-06-09 12:22:04.155011"], ["updated_at", "2025-06-09 12:22:04.155011"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/v1/tvshows?date_from=2025-06-09&date_to=2025-06-16&page=1&per_page=5" for 127.0.0.1 at 2025-06-09 13:22:04 +0100
Processing by Api::V1::TvShowsController#index as HTML
  Parameters: {"date_from" => "2025-06-09", "date_to" => "2025-06-16", "page" => "1", "per_page" => "5"}
  [1m[35mSQL (2.2ms)[0m  [1m[34mSELECT DISTINCT release_dates.airdate, release_dates.airtime, tv_shows.name, episodes.season, episodes.episode_number AS alias_0, "episodes"."id" FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC LIMIT $3 OFFSET $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["LIMIT", 5], ["OFFSET", 0]]
  [1m[35mSQL (13.4ms)[0m  [1m[34mSELECT DISTINCT "episodes"."id" AS t0_r0, "episodes"."name" AS t0_r1, "episodes"."season" AS t0_r2, "episodes"."episode_number" AS t0_r3, "episodes"."episode_type" AS t0_r4, "episodes"."runtime" AS t0_r5, "episodes"."rating" AS t0_r6, "episodes"."image_medium" AS t0_r7, "episodes"."image_original" AS t0_r8, "episodes"."summary" AS t0_r9, "episodes"."tv_show_id" AS t0_r10, "episodes"."tvmaze_id" AS t0_r11, "episodes"."created_at" AS t0_r12, "episodes"."updated_at" AS t0_r13, "tv_shows"."id" AS t1_r0, "tv_shows"."name" AS t1_r1, "tv_shows"."show_type" AS t1_r2, "tv_shows"."language" AS t1_r3, "tv_shows"."status" AS t1_r4, "tv_shows"."runtime" AS t1_r5, "tv_shows"."premiered" AS t1_r6, "tv_shows"."ended" AS t1_r7, "tv_shows"."official_site" AS t1_r8, "tv_shows"."rating" AS t1_r9, "tv_shows"."genres" AS t1_r10, "tv_shows"."schedule_time" AS t1_r11, "tv_shows"."schedule_days" AS t1_r12, "tv_shows"."image_medium" AS t1_r13, "tv_shows"."image_original" AS t1_r14, "tv_shows"."summary" AS t1_r15, "tv_shows"."network_id" AS t1_r16, "tv_shows"."tvmaze_id" AS t1_r17, "tv_shows"."created_at" AS t1_r18, "tv_shows"."updated_at" AS t1_r19, "distributors"."id" AS t2_r0, "distributors"."name" AS t2_r1, "distributors"."country" AS t2_r2, "distributors"."official_site" AS t2_r3, "distributors"."tvmaze_id" AS t2_r4, "distributors"."created_at" AS t2_r5, "distributors"."updated_at" AS t2_r6, "release_dates"."id" AS t3_r0, "release_dates"."airdate" AS t3_r1, "release_dates"."airtime" AS t3_r2, "release_dates"."episode_id" AS t3_r3, "release_dates"."created_at" AS t3_r4, "release_dates"."updated_at" AS t3_r5 FROM "episodes" INNER JOIN "tv_shows" ON "tv_shows"."id" = "episodes"."tv_show_id" INNER JOIN "release_dates" ON "release_dates"."episode_id" = "episodes"."id" LEFT OUTER JOIN "distributors" ON "distributors"."id" = "tv_shows"."network_id" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "episodes"."id" = $3 ORDER BY release_dates.airdate ASC, release_dates.airtime ASC, tv_shows.name ASC, episodes.season ASC, episodes.episode_number ASC[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 117]]
Completed 200 OK in 18ms (Views: 0.1ms | ActiveRecord: 15.6ms (2 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_processes_episode_data_correctly
------------------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.5ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:22:04.180522"], ["updated_at", "2025-06-09 12:22:04.180522"]]
  [1m[36mTvShow Load (0.6ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.4ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 168], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:22:04.183347"], ["updated_at", "2025-06-09 12:22:04.183347"]]
  [1m[36mEpisode Load (0.2ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 150], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 150], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 150], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:22:04.187529"], ["updated_at", "2025-06-09 12:22:04.187529"]]
  [1m[36mReleaseDate Load (1.5ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 118], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 118], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 118], ["created_at", "2025-06-09 12:22:04.192152"], ["updated_at", "2025-06-09 12:22:04.192152"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.4ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.5ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mDistributor Load (0.3ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."id" = $1 LIMIT $2[0m  [["id", 168], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."id" = $1 LIMIT $2[0m  [["id", 150], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" ORDER BY "release_dates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.4ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."id" = $1 LIMIT $2[0m  [["id", 118], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_is_idempotent
-----------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.1ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network Updated"], ["country", "United States"], ["official_site", nil], ["tvmaze_id", 789], ["created_at", "2025-06-09 12:22:04.210654"], ["updated_at", "2025-06-09 12:22:04.210654"]]
  [1m[36mTvShow Load (0.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.2ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show Updated"], ["show_type", "Scripted"], ["language", "English"], ["status", "Running"], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 169], ["tvmaze_id", 456], ["created_at", "2025-06-09 12:22:04.213624"], ["updated_at", "2025-06-09 12:22:04.213624"]]
  [1m[36mEpisode Load (0.5ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 151], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 151], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.4ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode Updated"], ["season", 1], ["episode_number", 1], ["episode_type", "regular"], ["runtime", 60], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 151], ["tvmaze_id", 123], ["created_at", "2025-06-09 12:22:04.218042"], ["updated_at", "2025-06-09 12:22:04.218042"]]
  [1m[36mReleaseDate Load (2.7ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 119], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 119], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", "20:00"], ["episode_id", 119], ["created_at", "2025-06-09 12:22:04.223683"], ["updated_at", "2025-06-09 12:22:04.223683"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
Starting ingestion of upcoming episodes for 90 days
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 789], ["LIMIT", 1]]
  [1m[36mTvShow Load (0.4ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 456], ["LIMIT", 1]]
  [1m[36mEpisode Load (0.7ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 123], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["season", 1], ["id", 119], ["tv_show_id", 151], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."id" != $2 AND "episodes"."tv_show_id" = $3 LIMIT $4[0m  [["episode_number", 1], ["id", 119], ["tv_show_id", 151], ["LIMIT", 1]]
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 119], ["airdate", "2025-06-09"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Ingestion completed: 1 processed, 0 errors
  [1m[36mDistributor Count (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "distributors"[0m
  [1m[36mTvShow Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "tv_shows"[0m
  [1m[36mEpisode Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "episodes"[0m
  [1m[36mReleaseDate Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mDistributor Load (0.2ms)[0m  [1m[34mSELECT "distributors".* FROM "distributors" ORDER BY "distributors"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTvShow Load (1.3ms)[0m  [1m[34mSELECT "tv_shows".* FROM "tv_shows" ORDER BY "tv_shows"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mEpisode Load (0.3ms)[0m  [1m[34mSELECT "episodes".* FROM "episodes" ORDER BY "episodes"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
TvmazeIngestionServiceTest: test_ingest_upcoming_episodes_handles_errors_gracefully
-----------------------------------------------------------------------------------
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_perform_ingestion_with_default_parameters
----------------------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.66s: 0 processed, 0 errors
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_call_TvmazeIngestionService
--------------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 90 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 46.56s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
DailyTvmazeIngestionJobTest: test_should_accept_custom_parameters
-----------------------------------------------------------------
Starting daily TVMaze ingestion job
Starting ingestion of upcoming episodes for 30 days
Ingestion completed: 0 processed, 0 errors
Daily ingestion completed in 16.21s: 0 processed, 0 errors
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_return_nil_without_airdate
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (2.8ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.719737"], ["updated_at", "2025-06-09 12:23:53.719737"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 170], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.728017"], ["updated_at", "2025-06-09 12:23:53.728017"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 152], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 152], ["LIMIT", 1]]
  [1m[36mEpisode Create (3.0ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 152], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.735486"], ["updated_at", "2025-06-09 12:23:53.735486"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_create_new_release_date
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.744167"], ["updated_at", "2025-06-09 12:23:53.744167"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 171], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.748338"], ["updated_at", "2025-06-09 12:23:53.748338"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 153], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 153], ["LIMIT", 1]]
  [1m[36mEpisode Create (1.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 153], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.755441"], ["updated_at", "2025-06-09 12:23:53.755441"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (8.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 121], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 121], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.5ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "21:30"], ["episode_id", 121], ["created_at", "2025-06-09 12:23:53.771075"], ["updated_at", "2025-06-09 12:23:53.771075"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ReleaseDateTest: test_should_be_valid_with_valid_attributes
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.4ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.775368"], ["updated_at", "2025-06-09 12:23:53.775368"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 172], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.778141"], ["updated_at", "2025-06-09 12:23:53.778141"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 154], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 154], ["LIMIT", 1]]
  [1m[36mEpisode Create (2.2ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 154], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.784196"], ["updated_at", "2025-06-09 12:23:53.784196"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 122], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
ReleaseDateTest: test_between_dates_scope_should_filter_by_date_range
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.790321"], ["updated_at", "2025-06-09 12:23:53.790321"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 173], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.791926"], ["updated_at", "2025-06-09 12:23:53.791926"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 155], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 155], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 155], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.796038"], ["updated_at", "2025-06-09 12:23:53.796038"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 123], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 123], ["created_at", "2025-06-09 12:23:53.799828"], ["updated_at", "2025-06-09 12:23:53.799828"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 200], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 2], ["tv_show_id", 155], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 5], ["tv_show_id", 155], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Future Episode"], ["season", 2], ["episode_number", 5], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 155], ["tvmaze_id", 200], ["created_at", "2025-06-09 12:23:53.802658"], ["updated_at", "2025-06-09 12:23:53.802658"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-07-09"], ["episode_id", 124], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-07-09"], ["airtime", nil], ["episode_id", 124], ["created_at", "2025-06-09 12:23:53.804673"], ["updated_at", "2025-06-09 12:23:53.804673"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 93], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" BETWEEN $1 AND $2 AND "release_dates"."id" = $3 LIMIT $4[0m  [["airdate", "2025-06-09"], ["airdate", "2025-06-16"], ["id", 94], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ReleaseDateTest: test_find_or_create_by_episode_data_should_find_existing_release_date
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.810965"], ["updated_at", "2025-06-09 12:23:53.810965"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.5ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 174], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.812688"], ["updated_at", "2025-06-09 12:23:53.812688"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 156], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 156], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 156], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.816069"], ["updated_at", "2025-06-09 12:23:53.816069"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-15"], ["episode_id", 125], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-15"], ["airtime", "20:00"], ["episode_id", 125], ["created_at", "2025-06-09 12:23:53.821572"], ["updated_at", "2025-06-09 12:23:53.821572"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mReleaseDate Load (0.3ms)[0m  [1m[34mSELECT "release_dates".* FROM "release_dates" WHERE "release_dates"."episode_id" = $1 AND "release_dates"."airdate" = $2 LIMIT $3[0m  [["episode_id", 125], ["airdate", "2025-06-15"], ["LIMIT", 1]]
  [1m[36mCACHE ReleaseDate Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "release_dates"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
ReleaseDateTest: test_should_belong_to_episode
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.3ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.825654"], ["updated_at", "2025-06-09 12:23:53.825654"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 175], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.827889"], ["updated_at", "2025-06-09 12:23:53.827889"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 157], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 157], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 157], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.834395"], ["updated_at", "2025-06-09 12:23:53.834395"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 126], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (3.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 126], ["created_at", "2025-06-09 12:23:53.837288"], ["updated_at", "2025-06-09 12:23:53.837288"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------
ReleaseDateTest: test_should_require_airdate
--------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.843619"], ["updated_at", "2025-06-09 12:23:53.843619"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (2.8ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 176], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.847106"], ["updated_at", "2025-06-09 12:23:53.847106"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 158], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 158], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.8ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 158], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.855475"], ["updated_at", "2025-06-09 12:23:53.855475"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" IS NULL AND "release_dates"."episode_id" = $1 LIMIT $2[0m  [["episode_id", 127], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
ReleaseDateTest: test_today_scope_should_include_today's_releases
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.7ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.861360"], ["updated_at", "2025-06-09 12:23:53.861360"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (1.1ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 177], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.864110"], ["updated_at", "2025-06-09 12:23:53.864110"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 159], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 159], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 159], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.869918"], ["updated_at", "2025-06-09 12:23:53.869918"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 300], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 3], ["tv_show_id", 159], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (5.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 10], ["tv_show_id", 159], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.5ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Today Episode"], ["season", 3], ["episode_number", 10], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 159], ["tvmaze_id", 300], ["created_at", "2025-06-09 12:23:53.880096"], ["updated_at", "2025-06-09 12:23:53.880096"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["episode_id", 129], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-09"], ["airtime", nil], ["episode_id", 129], ["created_at", "2025-06-09 12:23:53.883175"], ["updated_at", "2025-06-09 12:23:53.883175"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 128], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.4ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 128], ["created_at", "2025-06-09 12:23:53.885320"], ["updated_at", "2025-06-09 12:23:53.885320"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 97], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."id" = $2 LIMIT $3[0m  [["airdate", "2025-06-09"], ["id", 98], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ReleaseDateTest: test_should_require_unique_airdate_per_episode
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (1.0ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.890727"], ["updated_at", "2025-06-09 12:23:53.890727"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.7ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 178], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.893821"], ["updated_at", "2025-06-09 12:23:53.893821"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 160], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 160], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.6ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 160], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.897532"], ["updated_at", "2025-06-09 12:23:53.897532"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 130], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.3ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 130], ["created_at", "2025-06-09 12:23:53.900019"], ["updated_at", "2025-06-09 12:23:53.900019"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 130], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
ReleaseDateTest: test_upcoming_scope_should_include_future_dates
----------------------------------------------------------------
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDistributor Exists? (5.2ms)[0m  [1m[34mSELECT 1 AS one FROM "distributors" WHERE "distributors"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mDistributor Create (0.6ms)[0m  [1m[32mINSERT INTO "distributors" ("name", "country", "official_site", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["name", "Test Network"], ["country", nil], ["official_site", nil], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.909192"], ["updated_at", "2025-06-09 12:23:53.909192"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTvShow Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "tv_shows" WHERE "tv_shows"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mTvShow Create (0.6ms)[0m  [1m[32mINSERT INTO "tv_shows" ("name", "show_type", "language", "status", "runtime", "premiered", "ended", "official_site", "rating", "genres", "schedule_time", "schedule_days", "image_medium", "image_original", "summary", "network_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19) RETURNING "id"[0m  [["name", "Test Show"], ["show_type", nil], ["language", nil], ["status", nil], ["runtime", nil], ["premiered", nil], ["ended", nil], ["official_site", nil], ["rating", nil], ["genres", nil], ["schedule_time", nil], ["schedule_days", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["network_id", 179], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.911769"], ["updated_at", "2025-06-09 12:23:53.911769"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."tvmaze_id" = $1 LIMIT $2[0m  [["tvmaze_id", 1], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."season" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["season", 1], ["tv_show_id", 161], ["LIMIT", 1]]
  [1m[36mEpisode Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "episodes" WHERE "episodes"."episode_number" = $1 AND "episodes"."tv_show_id" = $2 LIMIT $3[0m  [["episode_number", 1], ["tv_show_id", 161], ["LIMIT", 1]]
  [1m[36mEpisode Create (0.7ms)[0m  [1m[32mINSERT INTO "episodes" ("name", "season", "episode_number", "episode_type", "runtime", "rating", "image_medium", "image_original", "summary", "tv_show_id", "tvmaze_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["name", "Test Episode"], ["season", 1], ["episode_number", 1], ["episode_type", nil], ["runtime", nil], ["rating", nil], ["image_medium", nil], ["image_original", nil], ["summary", nil], ["tv_show_id", 161], ["tvmaze_id", 1], ["created_at", "2025-06-09 12:23:53.916611"], ["updated_at", "2025-06-09 12:23:53.916611"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-10"], ["episode_id", 131], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (0.6ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-10"], ["airtime", "20:00"], ["episode_id", 131], ["created_at", "2025-06-09 12:23:53.919256"], ["updated_at", "2025-06-09 12:23:53.919256"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE "release_dates"."airdate" = $1 AND "release_dates"."episode_id" = $2 LIMIT $3[0m  [["airdate", "2025-06-08"], ["episode_id", 131], ["LIMIT", 1]]
  [1m[36mReleaseDate Create (1.0ms)[0m  [1m[32mINSERT INTO "release_dates" ("airdate", "airtime", "episode_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["airdate", "2025-06-08"], ["airtime", nil], ["episode_id", 131], ["created_at", "2025-06-09 12:23:53.921691"], ["updated_at", "2025-06-09 12:23:53.921691"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mReleaseDate Exists? (3.9ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 100], ["LIMIT", 1]]
  [1m[36mReleaseDate Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "release_dates" WHERE (airdate >= $1) AND "release_dates"."id" = $2 LIMIT $3[0m  [[nil, "2025-06-09"], ["id", 101], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
DateUtilityServiceTest: test_parse_date_returns_nil_for_empty_string
--------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
DateUtilityServiceTest: test_parse_date_returns_nil_for_invalid_date_string
---------------------------------------------------------------------------
Invalid date format: invalid-date - invalid date
Invalid date format: 2025-13-45 - invalid date
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DateUtilityServiceTest: test_parse_date!_returns_parsed_date_for_valid_string
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
DateUtilityServiceTest: test_format_date_returns_formatted_string_for_valid_date
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
DateUtilityServiceTest: test_parse_date_returns_parsed_date_for_valid_string
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DateUtilityServiceTest: test_parse_date!_raises_error_for_invalid_date_string
-----------------------------------------------------------------------------
Invalid date format: invalid-date - invalid date
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
DateUtilityServiceTest: test_safe_date_range_raises_error_when_start_date_is_after_end_date
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
DateUtilityServiceTest: test_safe_date_range_returns_parsed_dates_for_valid_range
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DateUtilityServiceTest: test_format_date_returns_nil_for_nil_input
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
